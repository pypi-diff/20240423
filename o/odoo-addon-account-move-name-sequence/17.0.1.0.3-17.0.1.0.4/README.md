# Comparing `tmp/odoo_addon_account_move_name_sequence-17.0.1.0.3-py3-none-any.whl.zip` & `tmp/odoo_addon_account_move_name_sequence-17.0.1.0.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,34 +1,35 @@
-Zip file size: 52456 bytes, number of entries: 32
--rw-r--r--  2.0 unx     6911 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/README.rst
--rw-r--r--  2.0 unx       55 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/__init__.py
--rw-r--r--  2.0 unx     1024 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/__manifest__.py
--rw-r--r--  2.0 unx     1302 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/hooks.py
--rw-r--r--  2.0 unx      445 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/demo/ir_sequence_demo.xml
--rw-r--r--  2.0 unx     5584 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/i18n/account_move_name_sequence.pot
--rw-r--r--  2.0 unx     6367 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/i18n/ar.po
--rw-r--r--  2.0 unx     6825 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/i18n/es.po
--rw-r--r--  2.0 unx     6803 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/i18n/fr.po
--rw-r--r--  2.0 unx     6683 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/i18n/hr.po
--rw-r--r--  2.0 unx     6815 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/i18n/it.po
--rw-r--r--  2.0 unx     6915 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/i18n/sl.po
--rw-r--r--  2.0 unx       83 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/models/__init__.py
--rw-r--r--  2.0 unx    10632 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/models/account_journal.py
--rw-r--r--  2.0 unx     3972 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/models/account_move.py
--rw-r--r--  2.0 unx     1913 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/models/ir_sequence.py
--rw-r--r--  2.0 unx      868 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/readme/CONFIGURE.md
--rw-r--r--  2.0 unx      334 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/readme/CONTRIBUTORS.md
--rw-r--r--  2.0 unx     2016 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/readme/DESCRIPTION.md
--rw-r--r--  2.0 unx      232 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/security/ir.model.access.csv
--rw-r--r--  2.0 unx     9455 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/static/description/icon.png
--rw-r--r--  2.0 unx    16920 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/static/description/index.html
--rw-r--r--  2.0 unx      134 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/tests/__init__.py
--rw-r--r--  2.0 unx     3062 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/tests/test_account_incoming_supplier_invoice.py
--rw-r--r--  2.0 unx    13827 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/tests/test_account_move_name_seq.py
--rw-r--r--  2.0 unx    14402 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/tests/test_sequence_concurrency.py
--rw-r--r--  2.0 unx     1619 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/views/account_journal.xml
--rw-r--r--  2.0 unx     1131 b- defN 24-Apr-22 21:06 odoo/addons/account_move_name_sequence/views/account_move.xml
--rw-r--r--  2.0 unx     7470 b- defN 24-Apr-22 21:06 odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/METADATA
--rw-r--r--  2.0 unx       83 b- defN 24-Apr-22 21:06 odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/WHEEL
--rw-r--r--  2.0 unx        4 b- defN 24-Apr-22 21:06 odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     3696 b- defN 24-Apr-22 21:06 odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/RECORD
-32 files, 147582 bytes uncompressed, 46130 bytes compressed:  68.7%
+Zip file size: 53225 bytes, number of entries: 33
+-rw-r--r--  2.0 unx     6911 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/README.rst
+-rw-r--r--  2.0 unx       55 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/__init__.py
+-rw-r--r--  2.0 unx     1065 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/__manifest__.py
+-rw-r--r--  2.0 unx     1302 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/hooks.py
+-rw-r--r--  2.0 unx      839 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/demo/account_journal_demo.xml
+-rw-r--r--  2.0 unx      963 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/demo/ir_sequence_demo.xml
+-rw-r--r--  2.0 unx     5910 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/i18n/account_move_name_sequence.pot
+-rw-r--r--  2.0 unx     6367 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/i18n/ar.po
+-rw-r--r--  2.0 unx     6825 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/i18n/es.po
+-rw-r--r--  2.0 unx     6803 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/i18n/fr.po
+-rw-r--r--  2.0 unx     6683 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/i18n/hr.po
+-rw-r--r--  2.0 unx     6815 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/i18n/it.po
+-rw-r--r--  2.0 unx     6915 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/i18n/sl.po
+-rw-r--r--  2.0 unx       83 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/models/__init__.py
+-rw-r--r--  2.0 unx    10632 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/models/account_journal.py
+-rw-r--r--  2.0 unx     3972 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/models/account_move.py
+-rw-r--r--  2.0 unx     1913 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/models/ir_sequence.py
+-rw-r--r--  2.0 unx      868 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/readme/CONFIGURE.md
+-rw-r--r--  2.0 unx      334 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/readme/CONTRIBUTORS.md
+-rw-r--r--  2.0 unx     2016 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/readme/DESCRIPTION.md
+-rw-r--r--  2.0 unx      232 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/security/ir.model.access.csv
+-rw-r--r--  2.0 unx     9455 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/static/description/icon.png
+-rw-r--r--  2.0 unx    16920 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/static/description/index.html
+-rw-r--r--  2.0 unx      134 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/tests/__init__.py
+-rw-r--r--  2.0 unx     3062 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/tests/test_account_incoming_supplier_invoice.py
+-rw-r--r--  2.0 unx    13827 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/tests/test_account_move_name_seq.py
+-rw-r--r--  2.0 unx    16240 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/tests/test_sequence_concurrency.py
+-rw-r--r--  2.0 unx     1619 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/views/account_journal.xml
+-rw-r--r--  2.0 unx     1131 b- defN 24-Apr-23 01:46 odoo/addons/account_move_name_sequence/views/account_move.xml
+-rw-r--r--  2.0 unx     7470 b- defN 24-Apr-23 01:46 odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/METADATA
+-rw-r--r--  2.0 unx       83 b- defN 24-Apr-23 01:46 odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/WHEEL
+-rw-r--r--  2.0 unx        4 b- defN 24-Apr-23 01:46 odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     3820 b- defN 24-Apr-23 01:46 odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/RECORD
+33 files, 151268 bytes uncompressed, 46687 bytes compressed:  69.1%
```

## zipnote {}

```diff
@@ -6,14 +6,17 @@
 
 Filename: odoo/addons/account_move_name_sequence/__manifest__.py
 Comment: 
 
 Filename: odoo/addons/account_move_name_sequence/hooks.py
 Comment: 
 
+Filename: odoo/addons/account_move_name_sequence/demo/account_journal_demo.xml
+Comment: 
+
 Filename: odoo/addons/account_move_name_sequence/demo/ir_sequence_demo.xml
 Comment: 
 
 Filename: odoo/addons/account_move_name_sequence/i18n/account_move_name_sequence.pot
 Comment: 
 
 Filename: odoo/addons/account_move_name_sequence/i18n/ar.po
@@ -78,20 +81,20 @@
 
 Filename: odoo/addons/account_move_name_sequence/views/account_journal.xml
 Comment: 
 
 Filename: odoo/addons/account_move_name_sequence/views/account_move.xml
 Comment: 
 
-Filename: odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/METADATA
+Filename: odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/METADATA
 Comment: 
 
-Filename: odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/WHEEL
+Filename: odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/WHEEL
 Comment: 
 
-Filename: odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/top_level.txt
+Filename: odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/RECORD
+Filename: odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/account_move_name_sequence/README.rst

```diff
@@ -3,15 +3,15 @@
 ============================
 
 .. 
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !! This file is generated by oca-gen-addon-readme !!
    !! changes will be overwritten.                   !!
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-   !! source digest: sha256:d4dc3a679a36646381fa2a369dbe3c8c1219c16c5e5880297898b38d620c47dc
+   !! source digest: sha256:07516ed300d9ede4c8d0b07fb09ab0cd4209e6072b6309d59127927c2ed23746
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 
 .. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
     :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
     :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
```

## odoo/addons/account_move_name_sequence/__manifest__.py

```diff
@@ -3,26 +3,27 @@
 # @author: Alexis de Lattre <alexis.delattre@akretion.com>
 # @author: Moisés López <moylop260@vauxoo.com>
 # @author: Francisco Luna <fluna@vauxoo.com>
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
 
 {
     "name": "Account Move Number Sequence",
-    "version": "17.0.1.0.3",
+    "version": "17.0.1.0.4",
     "category": "Accounting",
     "license": "AGPL-3",
     "summary": "Generate journal entry number from sequence",
     "author": "Akretion,Vauxoo,Odoo Community Association (OCA)",
     "maintainers": ["alexis-via", "moylop260", "frahikLV", "luisg123v"],
     "website": "https://github.com/OCA/account-financial-tools",
     "depends": [
         "account",
     ],
     "demo": [
         "demo/ir_sequence_demo.xml",
+        "demo/account_journal_demo.xml",
     ],
     "data": [
         "views/account_journal.xml",
         "views/account_move.xml",
         "security/ir.model.access.csv",
     ],
     "post_init_hook": "post_init_hook",
```

## odoo/addons/account_move_name_sequence/demo/ir_sequence_demo.xml

### odoo/addons/account_move_name_sequence/demo/ir_sequence_demo.xml

```diff
@@ -1,11 +1,21 @@
 <?xml version="1.0" encoding="utf-8"?>
 <odoo>
-  <record id="ir_sequence_demo" model="ir.sequence">
-    <field name="name">Standard Sequence Demo</field>
-    <field name="prefix">demo/%(range_year)s/</field>
+  <record id="seq_sale_std_demo" model="ir.sequence">
+    <field name="name">Standard Sale Sequence Demo</field>
+    <field name="prefix">SSS_demo/%(range_year)s/</field>
     <field name="use_date_range" eval="True"/>
     <field name="number_next">1</field>
     <field name="number_increment">1</field>
     <field name="company_id" ref="base.main_company"/>
+    <field name="implementation">standard</field>
+  </record>
+  <record id="seq_cash_std_demo" model="ir.sequence">
+    <field name="name">Standard Cash Sequence Demo</field>
+    <field name="prefix">SCS_demo/%(range_year)s/</field>
+    <field name="use_date_range" eval="True"/>
+    <field name="number_next">1</field>
+    <field name="number_increment">1</field>
+    <field name="company_id" ref="base.main_company"/>
+    <field name="implementation">standard</field>
   </record>
 </odoo>
```

## odoo/addons/account_move_name_sequence/i18n/account_move_name_sequence.pot

```diff
@@ -113,14 +113,24 @@
 #: model:ir.model.fields,field_description:account_move_name_sequence.field_account_bank_statement_line__sequence_prefix
 #: model:ir.model.fields,field_description:account_move_name_sequence.field_account_move__sequence_prefix
 #: model:ir.model.fields,field_description:account_move_name_sequence.field_account_payment__sequence_prefix
 msgid "Sequence Prefix"
 msgstr ""
 
 #. module: account_move_name_sequence
+#: model:account.journal,name:account_move_name_sequence.journal_cash_std_demo
+msgid "Standard Cash Journal Demo"
+msgstr ""
+
+#. module: account_move_name_sequence
+#: model:account.journal,name:account_move_name_sequence.journal_sale_std_demo
+msgid "Standard Sale Journal Demo"
+msgstr ""
+
+#. module: account_move_name_sequence
 #. odoo-python
 #: code:addons/account_move_name_sequence/models/account_journal.py:0
 #, python-format
 msgid ""
 "The company is not set on sequence '%(sequence)s' configured as credit note "
 "sequence of journal '%(journal)s'."
 msgstr ""
```

## odoo/addons/account_move_name_sequence/static/description/index.html

```diff
@@ -362,15 +362,15 @@
 <div class="document" id="account-move-number-sequence">
 <h1 class="title">Account Move Number Sequence</h1>
 
 <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 !! This file is generated by oca-gen-addon-readme !!
 !! changes will be overwritten.                   !!
 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-!! source digest: sha256:d4dc3a679a36646381fa2a369dbe3c8c1219c16c5e5880297898b38d620c47dc
+!! source digest: sha256:07516ed300d9ede4c8d0b07fb09ab0cd4209e6072b6309d59127927c2ed23746
 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
 <p><a class="reference external image-reference" href="https://odoo-community.org/page/development-status"><img alt="Beta" src="https://img.shields.io/badge/maturity-Beta-yellow.png" /></a> <a class="reference external image-reference" href="http://www.gnu.org/licenses/agpl-3.0-standalone.html"><img alt="License: AGPL-3" src="https://img.shields.io/badge/licence-AGPL--3-blue.png" /></a> <a class="reference external image-reference" href="https://github.com/OCA/account-financial-tools/tree/17.0/account_move_name_sequence"><img alt="OCA/account-financial-tools" src="https://img.shields.io/badge/github-OCA%2Faccount--financial--tools-lightgray.png?logo=github" /></a> <a class="reference external image-reference" href="https://translation.odoo-community.org/projects/account-financial-tools-17-0/account-financial-tools-17-0-account_move_name_sequence"><img alt="Translate me on Weblate" src="https://img.shields.io/badge/weblate-Translate%20me-F47D42.png" /></a> <a class="reference external image-reference" href="https://runboat.odoo-community.org/builds?repo=OCA/account-financial-tools&amp;target_branch=17.0"><img alt="Try me on Runboat" src="https://img.shields.io/badge/runboat-Try%20me-875A7B.png" /></a></p>
 <p>In Odoo version 13.0 and previous versions, the number of journal
 entries was generated from a sequence configured on the journal.</p>
 <p>In Odoo version 14.0, the number of journal entries can be manually set
 by the user. Then, the number attributed for the next journal entries in
 the same journal is computed by a complex piece of code that guesses the
```

## odoo/addons/account_move_name_sequence/tests/test_sequence_concurrency.py

```diff
@@ -36,30 +36,44 @@
 
 @tagged("post_install", "-at_install", "test_move_sequence")
 class TestSequenceConcurrency(TransactionCase):
     def setUp(self):
         super().setUp()
         self.product = self.env.ref("product.product_delivery_01")
         self.partner = self.env.ref("base.res_partner_12")
+        self.partner2 = self.env.ref("base.res_partner_1")
         self.date = fields.Date.to_date("1985-04-14")
+        self.journal_sale_std = self.env.ref(
+            "account_move_name_sequence.journal_sale_std_demo"
+        )
+        self.journal_cash_std = self.env.ref(
+            "account_move_name_sequence.journal_cash_std_demo"
+        )
 
     def _new_cr(self):
         return self.env.registry.cursor()
 
-    def _create_invoice_form(self, env, post=True):
+    def _create_invoice_form(
+        self, env, post=True, partner=None, ir_sequence_standard=False
+    ):
+        if partner is None:
+            # Use another partner to bypass "increase_rank" lock error
+            partner = self.partner
         ctx = {"default_move_type": "out_invoice"}
         with Form(env["account.move"].with_context(**ctx)) as invoice_form:
-            invoice_form.partner_id = self.partner
+            invoice_form.partner_id = partner
             invoice_form.invoice_date = self.date
 
             with invoice_form.invoice_line_ids.new() as line_form:
                 line_form.product_id = self.product
                 line_form.price_unit = 100.0
                 line_form.tax_ids.clear()
             invoice = invoice_form.save()
+        if ir_sequence_standard:
+            invoice.journal_id = self.journal_sale_std
         if post:
             invoice.action_post()
         return invoice
 
     def _create_payment_form(self, env, ir_sequence_standard=False):
         with Form(
             env["account.payment"].with_context(
@@ -70,17 +84,15 @@
         ) as payment_form:
             payment_form.partner_id = env.ref("base.res_partner_12")
             payment_form.amount = 100
             payment_form.date = self.date
 
             payment = payment_form.save()
         if ir_sequence_standard:
-            payment.move_id.journal_id.sequence_id = self.env.ref(
-                "account_move_name_sequence.ir_sequence_demo"
-            )
+            payment.move_id.journal_id = self.journal_cash_std
         payment.action_post()
         return payment
 
     def _clean_moves(self, move_ids, payment=None):
         """Delete moves created after finish unittest using
         self.addCleanup(
             self._clean_moves, self.env, (invoices | payments.mapped('move_id')).ids
@@ -105,18 +117,22 @@
             cr.execute("SET LOCAL statement_timeout = '%ss'", (deadlock_timeout + 10,))
             if payment_first:
                 _logger.info("Creating payment cr %s", cr_pid)
                 self._create_payment_form(
                     env, ir_sequence_standard=ir_sequence_standard
                 )
                 _logger.info("Creating invoice cr %s", cr_pid)
-                self._create_invoice_form(env)
+                self._create_invoice_form(
+                    env, ir_sequence_standard=ir_sequence_standard
+                )
             else:
                 _logger.info("Creating invoice cr %s", cr_pid)
-                self._create_invoice_form(env)
+                self._create_invoice_form(
+                    env, ir_sequence_standard=ir_sequence_standard
+                )
                 _logger.info("Creating payment cr %s", cr_pid)
                 self._create_payment_form(
                     env, ir_sequence_standard=ir_sequence_standard
                 )
         # sleep in order to avoid release the locks too faster
         # It could be many methods called after creating these
         # kind of records e.g. reconcile
@@ -262,16 +278,37 @@
 
             # Create "last move" to lock
             payment = self._create_payment_form(env0, ir_sequence_standard=True)
             payment_move_ids = payment.move_id.ids
             self.addCleanup(self._clean_moves, payment_move_ids)
             env0.cr.commit()
             with env1.cr.savepoint(), env2.cr.savepoint():
-                self._create_payment_form(env1)
-                self._create_payment_form(env2)
+                self._create_payment_form(env1, ir_sequence_standard=True)
+                self._create_payment_form(env2, ir_sequence_standard=True)
+
+    def test_sequence_concurrency_92_invoices(self):
+        """Creating concurrent invoices should not raises errors"""
+        with self._new_cr() as cr0, self._new_cr() as cr1, self._new_cr() as cr2:
+            env0 = api.Environment(cr0, SUPERUSER_ID, {})
+            env1 = api.Environment(cr1, SUPERUSER_ID, {})
+            env2 = api.Environment(cr2, SUPERUSER_ID, {})
+            for cr in [cr0, cr1, cr2]:
+                # Set 10s timeout in order to avoid waiting for release locks a long time
+                cr.execute("SET LOCAL statement_timeout = '10s'")
+
+            # Create "last move" to lock
+            invoice = self._create_invoice_form(env0, ir_sequence_standard=True)
+            self.addCleanup(self._clean_moves, invoice.ids)
+            env0.cr.commit()
+            with env1.cr.savepoint(), env2.cr.savepoint():
+                self._create_invoice_form(env1, ir_sequence_standard=True)
+                # Using another partner to bypass "increase_rank" lock error
+                self._create_invoice_form(
+                    env2, partner=self.partner2, ir_sequence_standard=True
+                )
 
     @tools.mute_logger("odoo.sql_db")
     def test_sequence_concurrency_95_pay2inv_inv2pay(self):
         """Creating concurrent payment then invoice and invoice then payment
         should not raises errors
         It raises deadlock sometimes"""
         with self._new_cr() as cr0:
```

## Comparing `odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/METADATA` & `odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/METADATA`

 * *Files 5% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo-addon-account_move_name_sequence
-Version: 17.0.1.0.3
+Version: 17.0.1.0.4
 Requires-Python: >=3.10
 Requires-Dist: odoo>=17.0a,<17.1dev
 Summary: Generate journal entry number from sequence
 Home-page: https://github.com/OCA/account-financial-tools
 License: AGPL-3
 Author: Akretion,Vauxoo,Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
@@ -18,15 +18,15 @@
 ============================
 
 .. 
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !! This file is generated by oca-gen-addon-readme !!
    !! changes will be overwritten.                   !!
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-   !! source digest: sha256:d4dc3a679a36646381fa2a369dbe3c8c1219c16c5e5880297898b38d620c47dc
+   !! source digest: sha256:07516ed300d9ede4c8d0b07fb09ab0cd4209e6072b6309d59127927c2ed23746
    !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 
 .. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
     :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
     :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
```

## Comparing `odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/RECORD` & `odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/RECORD`

 * *Files 8% similar despite different names*

```diff
@@ -1,13 +1,14 @@
-odoo/addons/account_move_name_sequence/README.rst,sha256=Y2rEHFMrTKsBLeCL9JTQ4u5jcA51-iI96UoPad3eQZ4,6911
+odoo/addons/account_move_name_sequence/README.rst,sha256=1uy4-k_lNdeOpyXa81Kd18SXntzu--zCwkPVG-GuN-0,6911
 odoo/addons/account_move_name_sequence/__init__.py,sha256=fEuAcBjL3pJ66NzKHBaddry5-57VBjPxhKuXvJbPDNk,55
-odoo/addons/account_move_name_sequence/__manifest__.py,sha256=8DhguBa_zKUaoV5t_8GQiNJMFzcr2emoJQlWNr66vrM,1024
+odoo/addons/account_move_name_sequence/__manifest__.py,sha256=jejOgeYJT8xkxBlNSUB7Jh9zFjgiNRPowcdqf7evSJE,1065
 odoo/addons/account_move_name_sequence/hooks.py,sha256=c3fp-b2IJw_Nhsc5G35DH3FGHFkiGas1Srcid7Vo1U4,1302
-odoo/addons/account_move_name_sequence/demo/ir_sequence_demo.xml,sha256=FhDlKfWxMSsztVT6Shg2DgtzKSmwkGBhYK6Bhq477W0,445
-odoo/addons/account_move_name_sequence/i18n/account_move_name_sequence.pot,sha256=JvVdyihX3lVCP60zAws8puKsEmFHbKuSeh8V6yHzwt8,5584
+odoo/addons/account_move_name_sequence/demo/account_journal_demo.xml,sha256=Wk6I7M9imYUggw9nP7f13fX9byB3im4xUo0Z48bCX2M,839
+odoo/addons/account_move_name_sequence/demo/ir_sequence_demo.xml,sha256=_H7vlW7odnHMiEK92Q3DAa8ORlI1EQ3Hbgq3nl7TQUU,963
+odoo/addons/account_move_name_sequence/i18n/account_move_name_sequence.pot,sha256=Cb8umG3iDOJX-qsGemC-9vhxoQsvtQF6uHgi5MVdK-w,5910
 odoo/addons/account_move_name_sequence/i18n/ar.po,sha256=jqVHdYjA9upwP1uqn8bvYTLZ16L-EKd5nclVJQLxgqM,6367
 odoo/addons/account_move_name_sequence/i18n/es.po,sha256=-Kwxfj6Sp3x2tTMvOZFKClP_L9bk1SODruPurQrHmWc,6825
 odoo/addons/account_move_name_sequence/i18n/fr.po,sha256=JCDYxJmv2dGkc06PDWs4KAN4Qm2M7E168anDPd9uOzs,6803
 odoo/addons/account_move_name_sequence/i18n/hr.po,sha256=s0sitCNwe2dlBQHhGs8GoQppBezAZ44YAKCsJxMpTms,6683
 odoo/addons/account_move_name_sequence/i18n/it.po,sha256=YGdPnPCER86lYgK4WziAUGZEuGqHqlMucH_vRtA1v48,6815
 odoo/addons/account_move_name_sequence/i18n/sl.po,sha256=4hnzXSMBSjeA7ER6II-815dBFNFF443pq17g-JMXZ0s,6915
 odoo/addons/account_move_name_sequence/models/__init__.py,sha256=p7OwekxNEJD7zuHd16Q2xjjbVGX8rf8ouStokin65NY,83
@@ -15,18 +16,18 @@
 odoo/addons/account_move_name_sequence/models/account_move.py,sha256=gmLkB6_cbmLzFzsKuAtIBKxC-v9rufecwRFBRUwiMf4,3972
 odoo/addons/account_move_name_sequence/models/ir_sequence.py,sha256=_Dq3jDZyWdsf3NqwaD4TS5Yahg4HK3guwt1KqEKKu-o,1913
 odoo/addons/account_move_name_sequence/readme/CONFIGURE.md,sha256=bGjdTUEO87GvYScPk797nDa2C1dn6_W04EyYwMLMN4c,868
 odoo/addons/account_move_name_sequence/readme/CONTRIBUTORS.md,sha256=FbmJ0X-q_NzKOWWhYiMnnds1pjHxs7LRixVN8-yCPGw,334
 odoo/addons/account_move_name_sequence/readme/DESCRIPTION.md,sha256=20Q8n3QJfSGO4QonPR38A93oRFimbXsykL04TskyRKc,2016
 odoo/addons/account_move_name_sequence/security/ir.model.access.csv,sha256=fEah3Gu7k2qJUfxQWvPZD_ctZ6ajTYU8wFg8NK8uzIg,232
 odoo/addons/account_move_name_sequence/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
-odoo/addons/account_move_name_sequence/static/description/index.html,sha256=sA3dFtMYRCuSEAH61UwF2AdFsKOs5aushW7dPonCVw0,16920
+odoo/addons/account_move_name_sequence/static/description/index.html,sha256=XKL79gVuAEmBSsCBDqfsC9xh4LcSoB5pmz6UntBp9Go,16920
 odoo/addons/account_move_name_sequence/tests/__init__.py,sha256=tuz57jYx8f69QIbxMYgSOofZBqeU1LLdb_6HXKFzaB0,134
 odoo/addons/account_move_name_sequence/tests/test_account_incoming_supplier_invoice.py,sha256=D7-DyIt8m8A8FZAXyqen5MKrcjJrdyzrpae3nO72nxk,3062
 odoo/addons/account_move_name_sequence/tests/test_account_move_name_seq.py,sha256=eLZnlKUjyvkVXk5s5mRLATfLXf4LznODDfkyHm1_KmU,13827
-odoo/addons/account_move_name_sequence/tests/test_sequence_concurrency.py,sha256=LfjZ_0BQrot2-9yHU4GdIj5NaIrgEfKB91pZjPavfzE,14402
+odoo/addons/account_move_name_sequence/tests/test_sequence_concurrency.py,sha256=dT_twQe6oXyv9JqKbhYni4FiLJMKwXZTtuxbje7vFy8,16240
 odoo/addons/account_move_name_sequence/views/account_journal.xml,sha256=C_A7Y22TUlJvrC61nE0DAnFSmmXxuwjQMPHpedLIOEQ,1619
 odoo/addons/account_move_name_sequence/views/account_move.xml,sha256=pCSnWFIpIryRd3kvBTR3HblEhqA52x4K8e_K4E6b6NU,1131
-odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/METADATA,sha256=Y7UEDlTJSDDrF4POwEvjeIwNCf-oSMpT_j8WoYFfaEo,7470
-odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/WHEEL,sha256=8Rd4enx1PCuyDWP4SABqO5Fv8rpaknqp3VzjoFFLa6c,83
-odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/top_level.txt,sha256=QE6RBQ0QX5f4eFuUcGgU5Kbq1A_qJcDs-e_vpr6pmfU,4
-odoo_addon_account_move_name_sequence-17.0.1.0.3.dist-info/RECORD,,
+odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/METADATA,sha256=9iOZq367DdXv6HdbyCo4dFoRW0iXuuJJtOUiTSs1_MA,7470
+odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/WHEEL,sha256=8Rd4enx1PCuyDWP4SABqO5Fv8rpaknqp3VzjoFFLa6c,83
+odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/top_level.txt,sha256=QE6RBQ0QX5f4eFuUcGgU5Kbq1A_qJcDs-e_vpr6pmfU,4
+odoo_addon_account_move_name_sequence-17.0.1.0.4.dist-info/RECORD,,
```

