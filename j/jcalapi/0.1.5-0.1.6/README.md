# Comparing `tmp/jcalapi-0.1.5.tar.gz` & `tmp/jcalapi-0.1.6.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "jcalapi-0.1.5.tar", max compression
+gzip compressed data, was "jcalapi-0.1.6.tar", max compression
```

## Comparing `jcalapi-0.1.5.tar` & `jcalapi-0.1.6.tar`

### file list

```diff
@@ -1,11 +1,13 @@
--rw-r--r--   0        0        0    35149 2024-02-07 07:45:42.178841 jcalapi-0.1.5/LICENSE
--rw-r--r--   0        0        0     3252 2024-02-07 07:45:42.178841 jcalapi-0.1.5/README.md
--rw-r--r--   0        0        0       63 2024-02-07 07:45:42.178841 jcalapi-0.1.5/jcalapi/__init__.py
--rw-r--r--   0        0        0    12574 2024-02-07 07:45:42.178841 jcalapi-0.1.5/jcalapi/app.py
--rw-r--r--   0        0        0      148 2024-02-07 07:45:42.178841 jcalapi-0.1.5/jcalapi/backend/__init__.py
--rw-r--r--   0        0        0     9061 2024-02-07 07:45:42.178841 jcalapi-0.1.5/jcalapi/backend/confluence.py
--rw-r--r--   0        0        0     9176 2024-02-07 07:45:42.178841 jcalapi-0.1.5/jcalapi/backend/exchange.py
--rw-r--r--   0        0        0      809 2024-02-07 07:45:42.178841 jcalapi-0.1.5/jcalapi/events.py
--rwxr-xr-x   0        0        0     2156 2024-02-07 07:45:42.178841 jcalapi-0.1.5/jcalapi/run.py
--rw-r--r--   0        0        0     1001 2024-02-07 07:45:42.178841 jcalapi-0.1.5/pyproject.toml
--rw-r--r--   0        0        0     4496 1970-01-01 00:00:00.000000 jcalapi-0.1.5/PKG-INFO
+-rw-r--r--   0        0        0    35149 2024-04-23 06:13:22.472004 jcalapi-0.1.6/LICENSE
+-rw-r--r--   0        0        0     3472 2024-04-23 06:13:22.472004 jcalapi-0.1.6/README.md
+-rw-r--r--   0        0        0       63 2024-04-23 06:13:22.472004 jcalapi-0.1.6/jcalapi/__init__.py
+-rw-r--r--   0        0        0    14088 2024-04-23 06:13:22.472004 jcalapi-0.1.6/jcalapi/app.py
+-rw-r--r--   0        0        0      148 2024-04-23 06:13:22.472004 jcalapi-0.1.6/jcalapi/backend/__init__.py
+-rw-r--r--   0        0        0     9061 2024-04-23 06:13:22.472004 jcalapi-0.1.6/jcalapi/backend/confluence.py
+-rw-r--r--   0        0        0     9176 2024-04-23 06:13:22.472004 jcalapi-0.1.6/jcalapi/backend/exchange.py
+-rw-r--r--   0        0        0     4820 2024-04-23 06:13:22.472004 jcalapi-0.1.6/jcalapi/backend/google.py
+-rw-r--r--   0        0        0      809 2024-04-23 06:13:22.472004 jcalapi-0.1.6/jcalapi/events.py
+-rwxr-xr-x   0        0        0     2156 2024-04-23 06:13:22.472004 jcalapi-0.1.6/jcalapi/run.py
+-rw-r--r--   0        0        0      408 2024-04-23 06:13:22.472004 jcalapi-0.1.6/jcalapi/utils.py
+-rw-r--r--   0        0        0     1018 2024-04-23 06:13:22.476004 jcalapi-0.1.6/pyproject.toml
+-rw-r--r--   0        0        0     4754 1970-01-01 00:00:00.000000 jcalapi-0.1.6/PKG-INFO
```

### Comparing `jcalapi-0.1.5/LICENSE` & `jcalapi-0.1.6/LICENSE`

 * *Files identical despite different names*

### Comparing `jcalapi-0.1.5/README.md` & `jcalapi-0.1.6/README.md`

 * *Files 15% similar despite different names*

```diff
@@ -46,14 +46,16 @@
 ```shell
 docker run -it --rm -p 127.0.0.1:7042:7042 \
   -e ONFLUENCE_URL=https://confluence.example.com \
   -e CONFLUENCE_USERNAME=john.doe \
   -e CONFLUENCE_PASSWORD=XXX \
   -e EXCHANGE_USERNAME=john.doe@example.com \
   -e EXCHANGE_PASSWORD=XXX \
+  -e GOOGLE_CREDENTIALS=/config/xxx.apps.googleusercontent.com.json \
+  -e GOOGLE_CALENDAR_REGEX='^Work '
   ghcr.io/pschmitt/jcalapi
 ```
 
 ## ðŸ“š API Usage
 
 The API provides endpoints for fetching calendar events. Here's an example of how to use it:
 
@@ -137,10 +139,15 @@
 ```
 
 3. Setup the environment
 ```shell
 poetry install
 ```
 
+Alternatives:
+
+- Use [devenv](https://devenv.sh)
+- Try the provided devcontainer (untested, generated by devenv)
+
 ## ðŸ“„ License
 
 This project is licensed under the [GNU General Public License v3.0](LICENSE).
```

### Comparing `jcalapi-0.1.5/jcalapi/app.py` & `jcalapi-0.1.6/jcalapi/app.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,47 +1,47 @@
 import datetime
 import logging
 import os
 import re
 from contextvars import ContextVar
 from typing import List, Optional
 
+import tzlocal
 import xdg
 from dateutil.parser import parse as dparse
-from dateutil.tz import tzlocal
-
-# from dateutil.utils import within_delta
 from diskcache import Cache
 from fastapi import FastAPI, HTTPException, Query
 from fastapi_utils.tasks import repeat_every
 
+import jcalapi.utils as utils
 from jcalapi.backend.confluence import get_confluence_events
 from jcalapi.backend.exchange import get_exchange_events
+from jcalapi.backend.google import get_google_events
 
 app = FastAPI()
 
 CALENDAR_DATA = {"exchange": [], "confluence": []}
 CACHE = Cache(os.path.join(xdg.xdg_cache_home(), "jcalapi"))
 CACHE_KEY_META_SUFFIX = "-metadata"
 CACHE_EXPIRY = 60 * 10  # 10 minutes
 CACHE_RESTORED = ContextVar("CACHE_RESTORED", default=False)
 
 PAST_DAYS_IMPORT = int(os.environ.get("PAST_DAYS_IMPORT", 0))
 FUTURE_DAYS_IMPORT = int(os.environ.get("FUTURE_DAYS_IMPORT", 14))
 START_DATE = (
     (
-        datetime.datetime.now(tz=tzlocal()).replace(
+        datetime.datetime.now(tz=tzlocal.get_localzone()).replace(
             hour=0, minute=0, second=0, microsecond=0
         )
         - datetime.timedelta(days=PAST_DAYS_IMPORT)
     )
     if PAST_DAYS_IMPORT > 0
     else None
 )
-END_DATE = datetime.datetime.now(tz=tzlocal()).replace(
+END_DATE = datetime.datetime.now(tz=tzlocal.get_localzone()).replace(
     hour=0, minute=0, second=0, microsecond=0
 ) + datetime.timedelta(days=FUTURE_DAYS_IMPORT)
 
 LOGGER = logging.getLogger(__name__)
 
 
 def events_merged(ignore_calendars: Optional[List[str]] = None):
@@ -78,14 +78,16 @@
             LOGGER.info(f"Loaded {key} data from cache")
         else:
             LOGGER.warning(f"Cache for {key} is empty. Requesting refresh")
             if key == "exchange":
                 await reload_exchange()
             elif key == "confluence":
                 await reload_confluence()
+            elif key == "google":
+                await reload_google()
 
     LOGGER.info("Cached values have been restored")
     CACHE_RESTORED.set(True)
 
 
 @app.on_event("startup")
 @repeat_every(seconds=60 * 5)  # 5 minutes
@@ -106,27 +108,37 @@
     confluence_url: Optional[str] = None,
     confluence_username: Optional[str] = None,
     confluence_password: Optional[str] = None,
     exchange_username: Optional[str] = None,
     exchange_password: Optional[str] = None,
     exchange_email: Optional[str] = None,
     exchange_shared_inboxes: Optional[list] = [],
+    google_credentials: Optional[str] = None,
+    google_calendar_regex: Optional[str] = None,
 ):
+    res_google = await reload_google(
+        credentials=google_credentials,
+        calendar_regex=google_calendar_regex,
+    )
     res_confluence = await reload_confluence(
         url=confluence_url,
         username=confluence_username,
         password=confluence_password,
     )
     res_exchange = await reload_exchange(
         username=exchange_username,
         password=exchange_password,
         email=exchange_email,
         shared_inboxes=exchange_shared_inboxes,
     )
-    return {"exchange": res_exchange, "confluence": res_confluence}
+    return {
+        "exchange": res_exchange,
+        "confluence": res_confluence,
+        "google": res_google,
+    }
 
 
 @app.post("/reload/confluence")
 async def reload_confluence(
     url: Optional[str] = None,
     username: Optional[str] = None,
     password: Optional[str] = None,
@@ -232,14 +244,47 @@
     )
 
     cache_events(backend)
 
     return {"events": len(CALENDAR_DATA.get(backend, []))}
 
 
+@app.post("/reload/google")
+async def reload_google(
+    credentials: Optional[str] = None,
+    calendar_regex: Optional[str] = None,
+):
+    google_credentials = (
+        credentials if credentials else os.environ.get("GOOGLE_CREDENTIALS")
+    )
+    google_calendar_regex = (
+        calendar_regex
+        if calendar_regex
+        else os.environ.get("GOOGLE_CALENDAR_REGEX")
+    )
+
+    backend = "google"
+
+    if google_credentials:
+        LOGGER.info("Fetching calendar events from google")
+        if START_DATE is not None or END_DATE is not None:
+            LOGGER.info(
+                f"Collecting events - Start={START_DATE}, End={END_DATE}"
+            )
+        CALENDAR_DATA[backend] = await get_google_events(
+            credentials=google_credentials,
+            calendar_regex=google_calendar_regex,
+            start=START_DATE,
+            end=END_DATE,
+        )
+        cache_events(backend)
+
+    return {"events": len(CALENDAR_DATA.get(backend, []))}
+
+
 @app.get("/events")
 @app.get("/events/{backend}")
 @app.get("/events/{backend}/{calendar}")
 async def events(
     backend: Optional[str] = "all", calendar: Optional[str] = "all"
 ):
     if backend and backend != "all" and backend not in CALENDAR_DATA.keys():
@@ -274,15 +319,15 @@
 @app.get("/now")
 async def get_current_events(
     ignore_calendars: Optional[List[str]] = Query(None),
 ):
     agenda = await get_events_at_date(
         "today", ignore_calendars=ignore_calendars
     )
-    now = datetime.datetime.now(tz=tzlocal())
+    now = datetime.datetime.now(tz=tzlocal.get_localzone())
     current_events = []
     for ev in agenda:
         ev_start = ev.get("start")
         ev_end = ev.get("end")
         if isinstance(ev_start, str):
             ev_start = dparse(ev_start)
         if isinstance(ev_end, str):
@@ -297,29 +342,29 @@
 @app.get("/today/{hours_prior}")
 async def get_todays_agenda(
     ignore_calendars: Optional[List[str]] = Query(None), hours_prior: int = 0
 ):
     agenda = await get_events_at_date(
         "today", ignore_calendars=ignore_calendars
     )
-    now = datetime.datetime.now(tz=tzlocal())
+    now = datetime.datetime.now(tz=tzlocal.get_localzone())
     # now = datetime.datetime.now()
     target_date = now + datetime.timedelta(hours=hours_prior)
     LOGGER.info(f"Get agenda for today's events - {hours_prior} hour")
     current_agenda = []
     for event in agenda:
         ev_end = event.get("end")
         if isinstance(ev_end, str):
             ev_end = dparse(ev_end)
         # Whole day events
         if not isinstance(ev_end, datetime.datetime):
             current_agenda.append(event)
         else:
             if not ev_end.tzinfo:
-                ev_end = ev_end.replace(tzinfo=tzlocal())
+                ev_end = ev_end.replace(tzinfo=tzlocal.get_localzone())
             if ev_end >= target_date:
                 current_agenda.append(event)
     return current_agenda
 
 
 @app.get("/tom")
 @app.get("/tomorrow")
@@ -332,21 +377,23 @@
 
 
 @app.get("/agenda/{when}")
 async def get_events_at_date(
     when: Optional[str] = "today",
     ignore_calendars: Optional[List[str]] = Query(None),
 ):
-    now = datetime.datetime.now(tz=tzlocal())
+    now = datetime.datetime.now(tz=tzlocal.get_localzone())
     target_date = now  # default to today ie now
 
     if when in ["tomorrow", "tom"]:
         target_date = now + datetime.timedelta(days=1)
     elif when in ["yesterday", "yest"]:
         target_date = now - datetime.timedelta(days=1)
+    elif when in ["monday", "mon"]:
+        target_date = utils.next_monday()
     elif match := re.match(r"^([+-]?\d+)$", when):
         target_date = now + datetime.timedelta(days=int(match.group(1)))
 
     LOGGER.info(f"Grabbing agenda for {target_date}")
 
     agenda = []
```

### Comparing `jcalapi-0.1.5/jcalapi/backend/confluence.py` & `jcalapi-0.1.6/jcalapi/backend/confluence.py`

 * *Files identical despite different names*

### Comparing `jcalapi-0.1.5/jcalapi/backend/exchange.py` & `jcalapi-0.1.6/jcalapi/backend/exchange.py`

 * *Files identical despite different names*

### Comparing `jcalapi-0.1.5/jcalapi/events.py` & `jcalapi-0.1.6/jcalapi/events.py`

 * *Files identical despite different names*

### Comparing `jcalapi-0.1.5/jcalapi/run.py` & `jcalapi-0.1.6/jcalapi/run.py`

 * *Files identical despite different names*

### Comparing `jcalapi-0.1.5/pyproject.toml` & `jcalapi-0.1.6/pyproject.toml`

 * *Files 12% similar despite different names*

```diff
@@ -1,39 +1,40 @@
 [tool.poetry]
 name = "jcalapi"
-version = "0.1.5"
+version = "0.1.6"
 description = "Local calendar caching and JSON API"
 authors = ["Philipp Schmitt <philipp@schmitt.co>"]
 license = "GPL-3"
 readme = "README.md"
 homepage = "https://github.com/pschmitt/jcalapi"
 
 [tool.poetry.dependencies]
 python = "^3.10"
 asynccli = "^0.1.3"
 atlassian-python-api = "^3.38.0"
 diskcache = "^5.6.1"
-environs = ">=9.5,<11.0"
-fastapi = ">=0.96,<0.110"
+environs = ">=9.5,<12.0"
+fastapi = ">=0.96,<0.111"
 fastapi-utils = "^0.2.1"
-httpx = ">=0.24.1,<0.27.0"
+httpx = ">=0.24.1,<0.28.0"
 icalendar = "^5.0.7"
 loguru = "^0.7.0"
 python-dateutil = "^2.8.2"
 recurring-ical-events = "^2.0.2"
-uvicorn = {extras = ["standard"], version = ">=0.22,<0.28"}
+uvicorn = {extras = ["standard"], version = ">=0.22,<0.30"}
 xdg = "^6.0.0"
 exchangelib = "^5.0.3"
 beautifulsoup4 = "^4.12.2"
-python-multipart = ">=0.0.6,<0.0.8"
+python-multipart = ">=0.0.6,<0.0.10"
+gcsa = "^2.2.0"
 
 [tool.poetry.dev-dependencies]
-black = "^24.1"
+black = "^24.3"
 flake8 = "^7.0.0"
-ipython = "^8.21.0"
+ipython = "^8.23.0"
 isort = "^5.13.2"
 
 [tool.poetry.scripts]
 jcalapi = 'jcalapi.run:main'
 
 [tool.black]
 line-length = 79
```

### Comparing `jcalapi-0.1.5/PKG-INFO` & `jcalapi-0.1.6/PKG-INFO`

 * *Files 7% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: jcalapi
-Version: 0.1.5
+Version: 0.1.6
 Summary: Local calendar caching and JSON API
 Home-page: https://github.com/pschmitt/jcalapi
 License: GPL-3
 Author: Philipp Schmitt
 Author-email: philipp@schmitt.co
 Requires-Python: >=3.10,<4.0
 Classifier: License :: Other/Proprietary License
@@ -12,25 +12,26 @@
 Classifier: Programming Language :: Python :: 3.10
 Classifier: Programming Language :: Python :: 3.11
 Classifier: Programming Language :: Python :: 3.12
 Requires-Dist: asynccli (>=0.1.3,<0.2.0)
 Requires-Dist: atlassian-python-api (>=3.38.0,<4.0.0)
 Requires-Dist: beautifulsoup4 (>=4.12.2,<5.0.0)
 Requires-Dist: diskcache (>=5.6.1,<6.0.0)
-Requires-Dist: environs (>=9.5,<11.0)
+Requires-Dist: environs (>=9.5,<12.0)
 Requires-Dist: exchangelib (>=5.0.3,<6.0.0)
-Requires-Dist: fastapi (>=0.96,<0.110)
+Requires-Dist: fastapi (>=0.96,<0.111)
 Requires-Dist: fastapi-utils (>=0.2.1,<0.3.0)
-Requires-Dist: httpx (>=0.24.1,<0.27.0)
+Requires-Dist: gcsa (>=2.2.0,<3.0.0)
+Requires-Dist: httpx (>=0.24.1,<0.28.0)
 Requires-Dist: icalendar (>=5.0.7,<6.0.0)
 Requires-Dist: loguru (>=0.7.0,<0.8.0)
 Requires-Dist: python-dateutil (>=2.8.2,<3.0.0)
-Requires-Dist: python-multipart (>=0.0.6,<0.0.8)
+Requires-Dist: python-multipart (>=0.0.6,<0.0.10)
 Requires-Dist: recurring-ical-events (>=2.0.2,<3.0.0)
-Requires-Dist: uvicorn[standard] (>=0.22,<0.28)
+Requires-Dist: uvicorn[standard] (>=0.22,<0.30)
 Requires-Dist: xdg (>=6.0.0,<7.0.0)
 Description-Content-Type: text/markdown
 
 # ðŸ“… jcalapi
 
 jcalapi is a local calendar cache and JSON API that interacts with Exchange and 
 Confluence calendars. It fetches events and returns them in a JSON format, 
@@ -78,14 +79,16 @@
 ```shell
 docker run -it --rm -p 127.0.0.1:7042:7042 \
   -e ONFLUENCE_URL=https://confluence.example.com \
   -e CONFLUENCE_USERNAME=john.doe \
   -e CONFLUENCE_PASSWORD=XXX \
   -e EXCHANGE_USERNAME=john.doe@example.com \
   -e EXCHANGE_PASSWORD=XXX \
+  -e GOOGLE_CREDENTIALS=/config/xxx.apps.googleusercontent.com.json \
+  -e GOOGLE_CALENDAR_REGEX='^Work '
   ghcr.io/pschmitt/jcalapi
 ```
 
 ## ðŸ“š API Usage
 
 The API provides endpoints for fetching calendar events. Here's an example of how to use it:
 
@@ -169,11 +172,16 @@
 ```
 
 3. Setup the environment
 ```shell
 poetry install
 ```
 
+Alternatives:
+
+- Use [devenv](https://devenv.sh)
+- Try the provided devcontainer (untested, generated by devenv)
+
 ## ðŸ“„ License
 
 This project is licensed under the [GNU General Public License v3.0](LICENSE).
```

