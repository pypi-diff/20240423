# Comparing `tmp/asktable-0.13.9-py3-none-any.whl.zip` & `tmp/asktable-0.14.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,34 +1,36 @@
-Zip file size: 29610 bytes, number of entries: 32
+Zip file size: 32325 bytes, number of entries: 34
 -rw-r--r--  2.0 unx       86 b- defN 24-Apr-02 15:29 asktable/__init__.py
 -rw-r--r--  2.0 unx     2180 b- defN 24-Apr-01 06:16 asktable/api.py
--rw-r--r--  2.0 unx     1667 b- defN 24-Apr-01 06:16 asktable/cli.py
--rw-r--r--  2.0 unx      887 b- defN 24-Apr-05 04:16 asktable/client.py
+-rw-r--r--  2.0 unx     2138 b- defN 24-Apr-18 01:39 asktable/cli.py
+-rw-r--r--  2.0 unx     1022 b- defN 24-Apr-22 12:27 asktable/client.py
 -rw-r--r--  2.0 unx       41 b- defN 24-Apr-01 06:16 asktable/exceptions.py
 -rw-r--r--  2.0 unx      875 b- defN 24-Apr-01 06:44 asktable/log.py
 -rw-r--r--  2.0 unx     1492 b- defN 24-Apr-01 06:16 asktable/upload.py
--rw-r--r--  2.0 unx      158 b- defN 24-Apr-06 09:09 asktable/models/__init__.py
--rw-r--r--  2.0 unx     2588 b- defN 24-Apr-01 06:16 asktable/models/client_base.py
--rw-r--r--  2.0 unx     2786 b- defN 24-Apr-06 09:09 asktable/models/client_chat.py
--rw-r--r--  2.0 unx    10445 b- defN 24-Apr-06 09:09 asktable/models/client_ds.py
--rw-r--r--  2.0 unx     1271 b- defN 24-Apr-06 09:09 asktable/models/client_msg.py
+-rw-r--r--  2.0 unx      248 b- defN 24-Apr-22 12:27 asktable/models/__init__.py
+-rw-r--r--  2.0 unx     2993 b- defN 24-Apr-22 14:18 asktable/models/client_base.py
+-rw-r--r--  2.0 unx     2571 b- defN 24-Apr-22 09:13 asktable/models/client_chat.py
+-rw-r--r--  2.0 unx    10712 b- defN 24-Apr-22 14:13 asktable/models/client_ds.py
+-rw-r--r--  2.0 unx     1270 b- defN 24-Apr-15 15:33 asktable/models/client_msg.py
 -rw-r--r--  2.0 unx      885 b- defN 24-Apr-06 09:09 asktable/models/client_run.py
+-rw-r--r--  2.0 unx     1165 b- defN 24-Apr-23 02:33 asktable/models/client_securetunnel.py
 -rw-r--r--  2.0 unx        0 b- defN 23-Dec-08 14:27 atcommon/__init__.py
 -rw-r--r--  2.0 unx     3296 b- defN 24-Apr-04 03:57 atcommon/tools.py
--rw-r--r--  2.0 unx       16 b- defN 24-Apr-08 11:30 atcommon/version.py
+-rw-r--r--  2.0 unx       16 b- defN 24-Apr-23 03:35 atcommon/version.py
 -rw-r--r--  2.0 unx        0 b- defN 24-Jan-31 13:33 atcommon/exceptions/__init__.py
--rw-r--r--  2.0 unx     1282 b- defN 24-Apr-02 15:21 atcommon/exceptions/client.py
+-rw-r--r--  2.0 unx     1402 b- defN 24-Apr-16 12:45 atcommon/exceptions/client.py
 -rw-r--r--  2.0 unx       95 b- defN 24-Apr-01 06:16 atcommon/exceptions/server.py
--rw-r--r--  2.0 unx     2089 b- defN 24-Apr-02 14:43 atcommon/exceptions/server_base.py
--rw-r--r--  2.0 unx      589 b- defN 24-Apr-01 06:16 atcommon/exceptions/server_plugins.py
--rw-r--r--  2.0 unx      466 b- defN 24-Apr-01 06:16 atcommon/models/__init__.py
+-rw-r--r--  2.0 unx     2599 b- defN 24-Apr-22 15:06 atcommon/exceptions/server_base.py
+-rw-r--r--  2.0 unx      597 b- defN 24-Apr-16 12:45 atcommon/exceptions/server_plugins.py
+-rw-r--r--  2.0 unx      526 b- defN 24-Apr-10 08:59 atcommon/models/__init__.py
 -rw-r--r--  2.0 unx      731 b- defN 24-Jan-20 03:26 atcommon/models/base.py
--rw-r--r--  2.0 unx     2344 b- defN 24-Apr-01 06:16 atcommon/models/bi.py
+-rw-r--r--  2.0 unx     4918 b- defN 24-Apr-17 07:47 atcommon/models/bi.py
 -rw-r--r--  2.0 unx     1069 b- defN 24-Apr-01 06:16 atcommon/models/chat.py
 -rw-r--r--  2.0 unx     1424 b- defN 24-Apr-03 14:46 atcommon/models/datasource.py
 -rw-r--r--  2.0 unx    27794 b- defN 24-Apr-06 01:31 atcommon/models/meta.py
--rw-r--r--  2.0 unx     9875 b- defN 24-Apr-08 11:30 asktable-0.13.9.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Apr-08 11:30 asktable-0.13.9.dist-info/WHEEL
--rw-r--r--  2.0 unx       47 b- defN 24-Apr-08 11:30 asktable-0.13.9.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       18 b- defN 24-Apr-08 11:30 asktable-0.13.9.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2581 b- defN 24-Apr-08 11:30 asktable-0.13.9.dist-info/RECORD
-32 files, 79169 bytes uncompressed, 25484 bytes compressed:  67.8%
+-rw-r--r--  2.0 unx      631 b- defN 24-Apr-23 03:34 atcommon/models/securetunnel.py
+-rw-r--r--  2.0 unx    11702 b- defN 24-Apr-23 05:05 asktable-0.14.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Apr-23 05:05 asktable-0.14.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx       47 b- defN 24-Apr-23 05:05 asktable-0.14.0.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       18 b- defN 24-Apr-23 05:05 asktable-0.14.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2765 b- defN 24-Apr-23 05:05 asktable-0.14.0.dist-info/RECORD
+34 files, 87400 bytes uncompressed, 27909 bytes compressed:  68.1%
```

## zipnote {}

```diff
@@ -33,14 +33,17 @@
 
 Filename: asktable/models/client_msg.py
 Comment: 
 
 Filename: asktable/models/client_run.py
 Comment: 
 
+Filename: asktable/models/client_securetunnel.py
+Comment: 
+
 Filename: atcommon/__init__.py
 Comment: 
 
 Filename: atcommon/tools.py
 Comment: 
 
 Filename: atcommon/version.py
@@ -75,23 +78,26 @@
 
 Filename: atcommon/models/datasource.py
 Comment: 
 
 Filename: atcommon/models/meta.py
 Comment: 
 
-Filename: asktable-0.13.9.dist-info/METADATA
+Filename: atcommon/models/securetunnel.py
+Comment: 
+
+Filename: asktable-0.14.0.dist-info/METADATA
 Comment: 
 
-Filename: asktable-0.13.9.dist-info/WHEEL
+Filename: asktable-0.14.0.dist-info/WHEEL
 Comment: 
 
-Filename: asktable-0.13.9.dist-info/entry_points.txt
+Filename: asktable-0.14.0.dist-info/entry_points.txt
 Comment: 
 
-Filename: asktable-0.13.9.dist-info/top_level.txt
+Filename: asktable-0.14.0.dist-info/top_level.txt
 Comment: 
 
-Filename: asktable-0.13.9.dist-info/RECORD
+Filename: asktable-0.14.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## asktable/cli.py

```diff
@@ -1,13 +1,19 @@
 import argparse
 import sys
 import os
+import requests
+
 sys.path.append(os.path.dirname(os.path.dirname(__file__)))
 
 
+def encrypt_the_str(s):
+    return s[:2] + '*' * (len(s) - 4) + s[-2:]
+
+
 def main():
     # 设置命令行参数解析
     parser = argparse.ArgumentParser(description="Interactive CLI for AskTable client.")
     parser.add_argument('-a', '--api_url',
                         type=str,
                         default='https://api.asktable.com',
                         help='The AskTable API URL')
@@ -16,24 +22,34 @@
                         default='',
                         help='The token for authentication.')
 
     args = parser.parse_args()
 
     # 导入 AskTable 类
     from asktable import AskTable
-    from asktable.exceptions import Unauthorized
+    from asktable.exceptions import Unauthorized, ServerConnectionError
     at = AskTable(token=args.token, api_url=args.api_url)
+    encrypted_token = encrypt_the_str(args.token)
     print(f"\n-- AskTable 客户端({at.version})初始化...")
     print("-- 连接服务器(-a)：", args.api_url)
     try:
+        response = requests.get("https://www.baidu.com")
+        response.raise_for_status()
+    except requests.exceptions.RequestException as e:
+        print("--本机网络异常")
+        return
+    try:
         t = at.token_id
     except Unauthorized:
         print(f"-- 使用Token (-t)： Token '{args.token}' 无效，请检查是否正确。")
         return
-    print("-- 使用Token (-t)：", args.token)
+    except ServerConnectionError:
+        print(f"--服务器连接异常...")
+        return
+    print("-- 使用Token (-t)：", encrypted_token)
     print("-- 您可以使用 'at' 来访问 AskTable，比如：通过 'at.datasources' 来查询数据源列表")
     print("   完整的使用方法，请参考帮助文档：https://pypi.org/project/asktable/\n")
 
     try:
         # 尝试导入 IPython
         from IPython import start_ipython
         start_ipython(argv=[], user_ns={'at': at})
```

## asktable/client.py

```diff
@@ -1,8 +1,8 @@
-from asktable.models import DataResourceList, ChatList
+from asktable.models import DataResourceList, ChatList, SecureTunnelList
 from asktable.api import APIRequest
 from atcommon.version import VERSION
 
 
 class AskTable:
     __version__ = VERSION
     version = VERSION
@@ -23,10 +23,14 @@
         return DataResourceList(api=self.api, endpoint="/datasources")
 
     @property
     def chats(self):
         return ChatList(api=self.api, endpoint="/chats")
 
     @property
+    def securetunnels(self):
+        return SecureTunnelList(api=self.api, endpoint="/securetunnels")
+
+    @property
     def token_id(self):
         return self.api.send(endpoint="/account/token", method="GET")
```

## asktable/models/__init__.py

```diff
@@ -1,7 +1,9 @@
 from asktable.models.client_ds import DataResourceList
 from asktable.models.client_chat import ChatList
+from asktable.models.client_securetunnel import SecureTunnelList
 
 __ALL__ = [
     "DataResourceList",
-    "ChatList"
+    "ChatList",
+    "SecureTunnelList",
 ]
```

## asktable/models/client_base.py

```diff
@@ -56,14 +56,25 @@
         resource = self._resources[self._current]
         self._current += 1
         return resource
 
     def _get_all_resources(self):
         raise NotImplementedError
 
+    def _get_all_resources_request(self):
+        params = {
+            "order": self.order,
+            "page_number": self.page_number,
+            "page_size": self.page_size
+        }
+        response = self.api.send(endpoint=self.endpoint, method="GET", params=params)
+
+        data = response.get('data', [])
+        return data
+
     def to_dict(self):
         return [resource.to_dict() for resource in self]
 
     def __repr__(self):
         # 将资源转换为字典列表
         resources_dicts = self.to_dict()
 
@@ -71,7 +82,10 @@
         if self.__do_not_print_properties__:
             for ds in resources_dicts:
                 for i in self.__do_not_print_properties__:
                     ds.pop(i)
 
         # 使用 tabulate 来生成表格格式的字符串
         return tabulate(resources_dicts, headers="keys", tablefmt="plain")
+
+    def count(self):
+        return len(self._get_all_resources())
```

## asktable/models/client_chat.py

```diff
@@ -35,38 +35,33 @@
         if not ts:
             return ''
         local_ts_readable = format_time_ago(ts)
         return local_ts_readable
 
     @convert_to_object(cls=ChatClientModel)
     def _get_all_resources(self):
-        return self._get_all_resources_request()
-
-    def _get_all_resources_request(self):
-        # 获取资源
-        params = {
-            "order": self.order,
-            "page_number": self.page_number,
-            "page_size": self.page_size
-        }
-        response = self.api.send(endpoint=self.endpoint, method="GET", params=params)
-
-        chats = response.get('data', [])
+        return self._get_all_chats()
 
+    def _get_all_chats(self):
+        chats = self._get_all_resources_request()
         # 转换 created 字段
         for chat in chats:
             chat['created'] = self._my_format_time(chat['created'])
             chat['latest_msg'] = self._my_format_time(chat['latest_msg'])
         return chats
 
     @property
     @convert_to_object(cls=ChatClientModel)
     def latest(self):
         # 获取最后一个资源
-        return self._get_all_resources_request()[0]
+        x = self._get_all_chats()
+        if x:
+            return x[0]
+        else:
+            return None
 
     def page(self, page_number=1):
         return ChatList(self.api, self.endpoint, page_number=page_number)
 
     def all(self):
         return ChatList(self.api, self.endpoint, page_number=0, page_size=0)
```

## asktable/models/client_ds.py

```diff
@@ -45,17 +45,17 @@
 
         异常:
             DataSourceMetaProcessError: 如果元数据更新失败。
             DataSourceMetaProcessTimeout: 如果元数据更新超时。
         """
         # 发起同步请求
         self.update()
-        return self.wait_until_update_success(timeout)
+        return self.wait_until_success(timeout)
 
-    def wait_until_update_success(self, timeout=600):
+    def wait_until_success(self, timeout=600):
         start_time = time.time()
 
         # 初始化斐波那契数列间隔
         fib_a, fib_b = 1, 1
 
         while True:
             # 获取数据源的最新状态
@@ -147,32 +147,23 @@
 class DataResourceList(BaseResourceList):
     __do_not_print_properties__ = ['tenant_id', 'access_config', 'sample_questions']
 
     @convert_to_object(cls=DataSourceClientModel)
     def _get_all_resources(self):
         return self._get_all_resources_request()
 
-    def _get_all_resources_request(self):
-        # 获取资源
-        params = {
-            "order": self.order,
-            "page_number": self.page_number,
-            "page_size": self.page_size
-        }
-        response = self.api.send(endpoint=self.endpoint, method="GET", params=params)
-
-        datasources = response.get('data', [])
-
-        return datasources
-
     @property
     @convert_to_object(cls=DataSourceClientModel)
     def latest(self):
         # 获取最后一个资源
-        return self._get_all_resources_request()[0]
+        x = self._get_all_resources_request()
+        if x:
+            return x[0]
+        else:
+            return None
 
     def page(self, page_number=1):
         return DataResourceList(self.api, self.endpoint, page_number=page_number)
 
     def all(self):
         return DataResourceList(self.api, self.endpoint, page_number=0, page_size=0)
 
@@ -187,18 +178,19 @@
 
         if not id:
             raise ValueError("No ID or Name provided")
         # 通过资源ID来获取
         return self.api.send(endpoint=f"{self.endpoint}/{id}", method="GET")
 
     @convert_to_object(cls=DataSourceClientModel)
-    def register(self, type, access_config, name=None):
+    def register(self, type, access_config, name=None, skip_process_meta=0):
         data = {
             "type": type, "name": name,
-            "access_config": access_config
+            "access_config": access_config,
+            "skip_process_meta": skip_process_meta
         }
         return self.api.send(endpoint=self.endpoint, method="POST",
                              data=data)
 
     def register_until_success(self, type, access_config, name=None, timeout=600):
         # 注册数据源并获取其ID
         ds = self.register(type, access_config, name)
@@ -250,34 +242,46 @@
         resp = self.api.send(
             endpoint=f"{self.endpoint}/upload_file",
             method="POST",
             files={'file': open(local_file_path, 'rb')}
         )
         return resp.get('url')
 
-    def create_from_local_file(self, local_file_path, direct_to_oss=True):
+    def create_from_local_file(self, local_file_path, direct_to_oss=True, until_success=False):
         file_ext = os.path.splitext(local_file_path)[-1]
         if file_ext not in ['.csv', '.xls', '.xlsx']:
             raise UnsupportedFileType(f"File type {file_ext} not supported")
 
         if direct_to_oss:
             url = self.upload_file_to_oss(local_file_path)
         else:
             url = self.upload_file_to_server(local_file_path)
 
         if file_ext == '.csv':
-            return self.register(type="csv", ds_access_config={
-                "location_type": "http",
-                "location_url": url,
-            })
+            if until_success:
+                return self.register_until_success(type="csv", access_config={
+                    "location_type": "http",
+                    "location_url": url,
+                })
+            else:
+                return self.register(type="csv", access_config={
+                    "location_type": "http",
+                    "location_url": url,
+                })
         elif file_ext in ['.xls', '.xlsx']:
-            return self.register(type="excel", ds_access_config={
-                "location_type": "http",
-                "location_url": url,
-            })
+            if until_success:
+                return self.register_until_success(type="excel", access_config={
+                    "location_type": "http",
+                    "location_url": url,
+                })
+            else:
+                return self.register(type="excel", access_config={
+                    "location_type": "http",
+                    "location_url": url,
+                })
         else:
             raise UnsupportedFileType(f"File type {file_ext} not supported")
 
     # def signed_url(self, url):
     #     resp = self.api.send(
     #         endpoint=f"{self.endpoint}/signed_url",
     #         method="GET",
```

## asktable/models/client_msg.py

```diff
@@ -10,15 +10,14 @@
     def answer(self):
         if self.role == 'ai':
             return BIAnswer.load_from_dict(self.content)
         else:
             return None
 
 
-
 class MessageList(BaseResourceList):
     __do_not_print_properties__ = ['chat_id']
 
     @convert_to_object(cls=MessageClientModel)
     def _get_all_resources(self):
         # 获取所有资源
         msgs = self.api.send(endpoint=self.endpoint, method="GET")
```

## atcommon/version.py

```diff
@@ -1 +1 @@
-VERSION="0.13.9"
+VERSION="0.14.0"
```

## atcommon/exceptions/client.py

```diff
@@ -1,45 +1,50 @@
 import inspect
 import sys
 from atcommon.exceptions.server import *
 
 
-class ServerConnectionError(Exception):
+class ClientBaseError(Exception):
+    code = 9
+    message = "Client Error"
+
+
+class ServerConnectionError(ClientBaseError):
     code = 9000
     message = "Server Connection Error"
 
 
-class ServerError(Exception):
+class ServerError(ClientBaseError):
     # 无法解析返回的数据，未知的服务器错误
     code = 9001
     message = "Server Error"
 
 
-class UnknownServerError(Exception):
+class UnknownServerError(ClientBaseError):
     # 服务器返回了错误码，但client端无法识别
     code = 9002
     message = "Unknown Server Error"
 
 
-class UploadFileError(Exception):
+class UploadFileError(ClientBaseError):
     code = 9003
     message = "Upload File Error"
 
 
-class UnsupportedFileType(Exception):
+class UnsupportedFileType(ClientBaseError):
     code = 9004
     message = "Unsupported File Type"
 
 
-class DataSourceMetaProcessError(Exception):
+class DataSourceMetaProcessError(ClientBaseError):
     code = 9005
     message = "Datasource Meta Process Error"
 
 
-class DataSourceMetaProcessTimeout(Exception):
+class DataSourceMetaProcessTimeout(ClientBaseError):
     code = 9006
     message = "Datasource Meta Process Timeout"
 
 
 def get_exception_by_code(code):
     for name, obj in inspect.getmembers(sys.modules[__name__]):
         if inspect.isclass(obj):
```

## atcommon/exceptions/server_base.py

```diff
@@ -1,33 +1,33 @@
 # Error Design
 
-class UncaughtError(Exception):
+class UnknownError(Exception):
     code = -1
-    message = "Uncaught Internal Error"
+    message = "Unknown Internal Error"
 
 
-class MyBaseError(Exception):
+class ServerBaseError(Exception):
     code = 0
     message = "Base error"
 
 
 # 1000 - 配置类错误
-class ManagementError(MyBaseError):
+class ManagementError(ServerBaseError):
     code = 1
     message = "Management Error"
 
 
 # 2000 - QA对话类错误
-class QAError(MyBaseError):
+class QAError(ServerBaseError):
     code = 2
     message = "Question Answering Error"
 
 
 # 3000 - 内部错误
-class InternalError(MyBaseError):
+class InternalError(ServerBaseError):
     code = 3
     message = "Internal error"
 
 
 ################################
 
 class Unauthorized(ManagementError):
@@ -55,25 +55,47 @@
     message = "Parameter error"
 
 
 class DataSourceConfigError(ManagementError):
     code = 1005
     message = "Datasource config error"
 
+
 class TenantNotFound(ManagementError):
     code = 1006
     message = "Tenant not found"
 
+
 class DataSourceMetaProcessing(ManagementError):
     code = 1007
     message = "Datasource meta processing"
 
 
+class DataSourceMetaNotReady(ManagementError):
+    code = 1008
+    message = "Datasource meta not ready!"
+
+
+class SecureTunnelNotFound(ManagementError):
+    code = 1009
+    message = "SecureTunnel not found"
+
+
+class SecureTunnelInUse(ManagementError):
+    code = 1010
+    message = "SecureTunnel in use"
+
+
+class ATSTServerAPIError(ManagementError):
+    code = 1011
+    message = "ATST Server API error"
+
 ################################
 
+
 class QAErrorNoMatchDataSource(QAError):
     code = 2002
     message = "No match datasource"
 
 
 class QAErrorInsufficientData(QAError):
     code = 2003
@@ -108,7 +130,11 @@
     message = "Invalid query syntax"
 
 
 class LLMServiceError(InternalError):
     code = 3003
     message = "LLM service error"
 
+
+class LLMRequestError(InternalError):
+    code = 3004
+    message = "LLM request error"
```

## atcommon/exceptions/server_plugins.py

```diff
@@ -1,9 +1,9 @@
 from atcommon.exceptions.server import DataSourceConfigError
-from atcommon.exceptions.server import MyBaseError
+from atcommon.exceptions.server import ServerBaseError
 # Excel
 
 class TooLargeFile(DataSourceConfigError):
     code = 10051
     message = "文件大小超过限制"
 
 class TooManyColumns(DataSourceConfigError):
@@ -15,9 +15,9 @@
     message = "文件中没有识别到表格"
 
 class InvalidFileExt(DataSourceConfigError):
     code = 10054
     message = "文件扩展名不合法"
 
 
-class ExcelProcessError(MyBaseError):
+class ExcelProcessError(ServerBaseError):
     pass
```

## atcommon/models/__init__.py

```diff
@@ -1,18 +1,20 @@
 from atcommon.models.datasource import DataSourceCore
 from atcommon.models.meta import MetaData, DataField, DataTable, DataSchema
 from atcommon.models.chat import ChatCore, MessageCore, RunCore
-from atcommon.models.bi import StrucQuery, QueryResult, BIAnswer
+from atcommon.models.bi import StrucQuery, QueryResult, BIAnswer, UserQuestion, Question
 
 __all__ = [
     'MetaData',
     'DataField',
     'DataTable',
     'DataSchema',
     'DataSourceCore',
     'ChatCore',
     'MessageCore',
     'RunCore',
     'StrucQuery',
     'QueryResult',
     'BIAnswer',
+    'UserQuestion',
+    'Question',
 ]
```

## atcommon/models/bi.py

```diff
@@ -1,65 +1,74 @@
 from atcommon.models.base import BaseCoreModel
 
-class BIQuestion:
+
+class Question:
 
     def __init__(self, content):
         self.content = content
 
     def __str__(self):
-        return self.content
-
-class BIQueryPlan:
-    pass
+        return f"Q[{self.content}]"
 
 
-class NaturalQuery:
-
-    def __init__(self, content: str):
-        self.content = content
+class UserQuestion(Question):
 
     def __str__(self):
-        return self.content
+        return f"USER-Q[{self.content}]"
 
 
 class StrucQuery:
 
     def __init__(self, content: str, params: dict = None):
         self.content = content
         self.params = params or {}
 
     def __str__(self):
+        return self.to_string()
+
+    def __repr__(self):
+        return f"SQ[{self.to_string()[:20]}...]"
+
+    def to_string(self):
         if self.params:
             params_formatted = "\n".join([f"{key}={value}" for key, value in self.params.items()])
-            return f"Query: \n{self.content}\nParams:\n{params_formatted}"
+            return f"{self.content}\nParams:\n{params_formatted}"
         else:
-            return f"Query: \n{self.content}"
-
-    def __repr__(self):
-        return self.__str__()
+            return f"{self.content}"
 
 
 class QueryResult:
 
-    def __init__(self, query: StrucQuery, result):  # result: DataFrame
+    def __init__(self, query: StrucQuery, result, query_time_ms: int):  # result: DataFrame
         self.query = query
         self.result = result
+        self.query_time_ms = query_time_ms
 
     def __str__(self):
-        return self.to_string(top_n=3)
+        return self.__repr__()
 
     def __repr__(self):
-        return f"Data Result: {self.row_count} 行 {self.column_count} 列"
+        return f"{self.query} -> R[{self.row_count} 行 {self.column_count} 列]"
+
+    def to_dict(self):
+        return {
+            "query": self.query.to_string(),
+            "result_info": {
+                "row_count": self.row_count,
+                "column_count": self.column_count,
+                "columns": self.columns.tolist(),
+            },
+            "query_time_ms": self.query_time_ms,
+        }
 
     def to_string(self, top_n=100):
         # 截取 前N行
         query_str = str(self.query)
         result_str = self.result.head(top_n).to_string(index=False)
-        return f"\nQuery: \n{query_str}\nResult({top_n} of {self.row_count}rows):\n{result_str}"
-
+        return f"\nQuery: \n{query_str}\nResult(Max:{self.row_count}rows, Top:{top_n}):\n{result_str}"
 
     @property
     def rows(self):
         return self.result.to_numpy()
 
     @property
     def columns(self):
@@ -75,22 +84,73 @@
 
 
 class BIAnswer(BaseCoreModel):
     __properties_init__ = [
         'status',
         'elapsed_time',
         'answer_text',
-        'answer_file_url',
-        'answer_image_url',
-        'structure_queries',
-        'statistics',
-        # 'insights',  # Transparency Reports
+        'files',
+        'charts',
+        'query_insights',  # Transparency Reports
+        'payload',
+
     ]
 
     def __str__(self):
-        file_str = f"[File:{self.answer_file_url}]" if self.answer_file_url else ''
-        image_str = f"[Image:{self.answer_image_url}]" if self.answer_image_url else ''
+        file_str = f"[File:{[f.get('url') for f in self.files]}]" if self.files else ''
+        image_str = f"[Image:{[c.get('url') for c in self.charts]}]" if self.charts else ''
         return f"[{self.status}-{self.elapsed_time}s] {self.answer_text} {file_str} {image_str}"
 
     def __repr__(self):
         return self.__str__()
 
+    def query_insights_to_string(self):
+        """
+        将query_insights转换为字符串
+            [{
+                    "question": "查询超过平均分的有多少人",
+                    "datasource": data_source.id,
+                    "results": [
+                        {
+                            "query": "select avg(score) from user",
+                            "result_info": {
+                                "row_count": self.row_count,
+                                "column_count": self.column_count,
+                                "columns": self.columns.tolist(),
+                            },
+                            "query_time_ms": 123,
+                        },
+                        {
+                            "query": "select count(*) from user where score > avg_score",
+                            "result_info": {
+                                "row_count": self.row_count,
+                                "column_count": self.column_count,
+                                "columns": self.columns.tolist(),
+                            },
+                            "query_time_ms": 123,
+                        },
+                    ],
+                    "query_time": int(time.time() - _begin),
+             },
+            ]
+        """
+        if not self.query_insights:
+            return ''
+
+        output = []
+        for task_index, task in enumerate(self.query_insights, start=1):
+            # 添加任务标题
+            output.append(f"任务{task_index}：[{task['query_time']}秒]{task['question']}")
+            output.append("详细步骤：")
+
+            for step_index, result in enumerate(task['results'], start=1):
+                query = result['query']
+                row_count = result['result_info']['row_count']
+                column_count = result['result_info']['column_count']
+                # 转换为秒，保留1位小数
+                query_time = round(result['query_time_ms'] / 1000, 1)
+
+                # 格式化每个查询步骤的描述
+                output.append(f"   {step_index}. [{query_time}秒]{query} -> [{row_count}行{column_count}列]")
+            output.append("")
+
+        return '\n'.join(output)
```

## Comparing `asktable-0.13.9.dist-info/METADATA` & `asktable-0.14.0.dist-info/METADATA`

 * *Files 24% similar despite different names*

```diff
@@ -1,37 +1,39 @@
 Metadata-Version: 2.1
 Name: asktable
-Version: 0.13.9
+Version: 0.14.0
 Summary: AskTable SDK
 Home-page: https://asktable.com/
 Author: lele
 Description-Content-Type: text/markdown
 Requires-Dist: requests
 Requires-Dist: tabulate
 Requires-Dist: pybase62
 
 # Python Client SDK（Python客户端SDK）
 
-## APIs（API 接口）
+## 1 APIs（API 接口）
 
 > API 接口列表： https://api.asktable.com/
  
-## 认证方法
+## 2 认证方法
 需要在 Header 中增加 Authorization 字段，值为 `Bearer <token>`，其中 `<token>` 为用户的 Token。
 
 注意：新用户请联系 `contact@datamini.ai` 获得token。
 
-## 安装
+## 3 安装
+
+依赖 Python 3.9+。
 
 ```shell
 pip install asktable
 ```
 
 
-## 使用方式
+## 4 使用方式
 
    - **命令行CLI**
        ```shell
        $ pip install asktable
        $ asktable -t <token>
     
        -- AskTable 客户端(0.7.19)初始化完成！
@@ -50,39 +52,44 @@
     ```python
     from asktable import AskTable 
     at = AskTable(token='your_token')
     ds = at.datasources.create_from_local_file("your_excel_file_path")
     ds.ask('总共有多少行？')
     ```
 
-## 使用示例
+## 5 使用示例
 
 以下示例使用命令行CLI方式演示。
 
-### 注册数据源
+### 5.1 注册数据源
+
+1. 注册 MySQL 数据源
 
-1. 注册 MySQL 数据源，这个地址必须是 AskTable Server可访问的
     ```python
     at.datasources.register(
         type="mysql",
         access_config={
             "host": "localhost",
             "port": 3306,
             "user": "root",
             "password": "",
             "db": "test"  # 可选
+            "securetunnel_id": "atst_p94FEWbXDWWDW3VC" #可选
         }
     )
     Data Source ds_2MSqC5EUFawpK0nVOg8MXN: Wait for 1 seconds and check again. Current status: processing
     Data Source ds_2MSqC5EUFawpK0nVOg8MXN: Wait for 2 seconds and check again. Current status: processing
     Data Source ds_2MSqC5EUFawpK0nVOg8MXN: Wait for 3 seconds and check again. Current status: processing
     Data Source ds_2MSqC5EUFawpK0nVOg8MXN: Wait for 5 seconds and check again. Current status: processing
     Data Source ds_2MSqC5EUFawpK0nVOg8MXN: Wait for 8 seconds and check again. Current status: processing
     Data Source ds_2MSqC5EUFawpK0nVOg8MXN  AI Process Success.
     ```
+    
+`access_config` 中的 `securetunnel_id` 为可选项，如果您的数据源需要通过 ATST 访问，请填写此字段。AskTable 会通过您的这个 ATST 来访问这个数据源，确保数据传输的安全性。
+
 2. 注册一个可下载的文件(Excel或CSV)
     ```python
     at.datasources.register(
         type="csv",
         access_config={
             "location_url": "https://example.com/path/to/myfile.csv",
             "location_type": "http",
@@ -92,15 +99,15 @@
 
 3. 上传并注册一个本地的文件（Excel或CSV）
     ```python
     In [69]: at.datasources.create_from_local_file(local_file_path="/DataMini/asktable/sample_data/tests/test_chart.xlsx", direct_to_oss=True)
     Out[69]: <ds_mrQq88Pu2DaBLCUZwgBAO: 月销售数据 >
     ```
 
-### 查找数据源
+### 5.2 查找数据源
 
 1. 所有数据源
     ```python
     In [54]: at.datasources
     Out[54]: 
     id                         created_at           name                                     type
     ds_1MEd5IA392sgt7mw5PcwgV  2024-01-21T17:09:18  高校讲师工作量汇总                       excel
@@ -130,15 +137,15 @@
     In [57]: at.datasources.get(name='杭州房产信息')
     Out[57]: 
     [<ds_25vqFPq3wAgzcCVGoygBOO: 杭州房产信息 >,
      <ds_2eGWHUvUbWN0AAbke0aKIb: 杭州房产信息 >,
      <ds_2TDFez0l0qiSwFLsGvRKvV: 杭州房产信息 >]
     ```
 
-### 管理数据源
+### 5.3 管理数据源
 
 1. 查看Meta（在AskTable中管理的Meta）
     ```python
     In [15]: at.datasources.latest.meta
     Out[15]: 
     test (测试环境数据库)
     ------------------------------
@@ -176,35 +183,37 @@
 
 4. 查看 Meta 状态
     ```python
     In [21]: at.datasources.latest.meta.status
     Out[21]: 'success'
     ```
    
-4. 删除 Meta（将AskTable中保存的Meta删除）
+5. 删除 Meta（将AskTable中保存的Meta删除）
     ```python
     In [18]: at.datasources.latest.meta.delete()
     Out[18]: True
     ```
 
-4. 查看示例问题
+6. 查看示例问题
     ```python
     In [62]: ds = at.datasources.latest
     
     In [63]: ds.sample_questions
     Out[63]: '- 查询杭州房产的平均总价\n- 统计各区域房产数量 \n（为了方便沟通，您可以直接指定列名：城市, 区域, 子区域, 小区, 总价, 单价, 户型, 楼层, 建筑面积, 套内面积, 装修, 梯户比例, 电梯, 别墅类型, 挂牌日期, 产权, 房屋用途, 房龄, 链接）'
     ```
-5. 删除数据源
+   
+7. 删除数据源
 
     ```python 
     In [65]: ds = at.datasources.latest.delete()  # 删除最新的数据源
     Out[65]: True
     ```
+   同时会删除这个数据源对应的 AskTable SecureTunnel Link（ATST Link）。
 
-### 开始对话
+### 5.4 开始对话
 
 1. 快速提问
     ```python
     In [8]: answer = at.datasources.latest.ask('你好')
     Out[8]: [msg_5PvPIvwPofYG9HkUzjzzRc] [ai] [OK-10s] 你好！有什么可以帮助你的吗？   [Just now]>
     ```
 
@@ -226,15 +235,15 @@
       'answer_file_url': None,
       'answer_image_url': None,
       'structure_queries': None,
       'statistics': None},
      'reply_to_msg_id': 'msg_7aEuVCH8fX9BzlS3EvwKnl'}
     ```
    
-### 查看对话
+### 5.5 查看对话
 
 1. 查看所有对话
     ```python
     In [40]: at.chats
     Out[40]: 
     id                           created              datasource_ids                   human_msgs    ai_msgs  latest_msg
     chat_E90pdsNUlDE7wo8gsjahf   2024-01-06 12:10:00  ['ds_1ZAoAyIn1ph0lldief4cP5']             2          2  2024-01-07 01:26:48
@@ -260,18 +269,71 @@
     id                          created                 role    content
     msg_1x0t6ch4KzZiSPFDbrL1iC  2 hours 59 minutes ago  human   将B列的数据拆分为姓名、手机号和地址三列
     msg_5D5bdJ2vBYjhpjlVuqyN5N  2 hours 59 minutes ago  ai      [OK-22s] 很抱歉，由于元数据中并未提供包含电话号码和地址的字段信息，我们无法直接从数据库中分割列B的数据为姓名、电话号码和地址三个独立的列。如果您能提供更详细的数据格式或者具体的分割规则，我们可能会有其他方式来帮助您处理这个问题。
     msg_1rnZp94PzQeMetZxV2W3VC  2 hours 57 minutes ago  human   看起来好像可以按照换行来拆分
     msg_1igXXP1VBMSVx2iW8DENVt  2 hours 57 minutes ago  ai      [OK-34s] 已经根据您的要求将B列的数据拆分为姓名、手机号和地址三列。您可以查看处理好的数据。 [File:https://0vc.cc/KcZzK]
     ```
 
-### 删除对话
+### 5.6 删除对话
 
 删除某个对话
 
     ```python
     In [45]: chat = at.chats.latest
     
     In [46]: chat.delete()
     Out[46]: True
     ```
 
+### 5.7 安全隧道 AskTable Secure Tunnel(ATST)
+
+
+1. 创建 ATST，申请一个Key
+
+用于创建一个新的 AskTable Secure Tunnel (ATST)，并返回一个唯一的 `securetunnel_id`。
+
+```python
+    In [1]: atst = at.securetunnels.create()
+    Out[1]: <SecureTunnel: atst_p94PzQeMetZxV2W3VC>
+```
+
+2. 查看所有的 ATST
+```python
+    In [2]: at.securetunnels
+    Out[2]: 
+    key                         created_at           
+    atst_p94PzQeMetZxV2W3VC    2024-01-06 12:10:00  
+    atst_p94PzQeMetZxV2W3VC    2024-01-07 05:35:03  
+    atst_p94PzQeMetZxV2W3VC  2024-01-07 05:46:21  
+    atst_p94PzQeMetZxV2W3VC  2024-01-07 10:34:15
+```
+
+3. 获取 ATST 的配置信息
+    
+    ```python
+        In [2]: at.securetunnels.get('atst_p94PzQeMetZxV2W3VC')
+        Out[2]: {
+        "id": "atst_p94PzQeMetZxV2W3VC",
+        "atst_server_host": "atst-server.asktable.com",
+        "atst_server_port": 7077,
+        "links": [
+            {
+                "id": "link_1",
+                "target_host": "10.1.2.3",
+                "target_port": 3306,
+                "proxy_port": 6001,
+            },
+            {
+                "id": "link_1",
+                "target_host": "10.1.2.4",
+                "target_port": 3306,
+                "proxy_port": 6002,
+            }, 
+        ]}
+    ```
+
+4. 获取某个ATST上绑定的所有Link
+  
+```python
+    In [3]: at.securetunnels.get('atst_p94PzQeMetZxV2W3VC').links
+    Out[3]:
+```
```

## Comparing `asktable-0.13.9.dist-info/RECORD` & `asktable-0.14.0.dist-info/RECORD`

 * *Files 21% similar despite different names*

```diff
@@ -1,32 +1,34 @@
 asktable/__init__.py,sha256=12mHQ4Yrr7_vY7ilhc6_tdOtuclBWPWj88YFIiTTU6I,86
 asktable/api.py,sha256=e5XbDpNv3V0OVdpUin6xhkA1xW0u-Jik5wFlS_2ZkiY,2180
-asktable/cli.py,sha256=QDzk5ixcWzD0fT345a6jW7D8JXp9ps9xRLvXT4Uh-Kc,1667
-asktable/client.py,sha256=D50bWrMySDdJdsLs-AxD1oHCeEpRn_4R2_x_XHaMWS8,887
+asktable/cli.py,sha256=oNhuGdEB_jD_1ru40CcLhsul2VVaWq_VuiEYVbO-uwY,2138
+asktable/client.py,sha256=vZHdgqeRvRwRR5K1p450aoVfNZlKPH--aT2HUg8lcvc,1022
 asktable/exceptions.py,sha256=HUys_aPowtoLqjO4XhANXBQCUUpty1zLxV4fWPqBkLc,41
 asktable/log.py,sha256=CIRsQtXMB24sD5fFsUn2hxlEVJB33Ej8TIQKyET2pQ8,875
 asktable/upload.py,sha256=ZctBvZtKnBZWucRXzvdp25zBNGz3eQ6PAfdhzLzfMUU,1492
-asktable/models/__init__.py,sha256=WMzWjKYe9ls4w_MlwfyIrOh4z7c5I2ITqMmZVWatlYg,158
-asktable/models/client_base.py,sha256=vDe19yuK6SJglgRlz8Gq9qKg_x1Cxs2tK82VKeJ3UCI,2588
-asktable/models/client_chat.py,sha256=JmNMpp0gqgH2x3MXX8rnxP3CLubXOuVSkiG1Qs9yyXk,2786
-asktable/models/client_ds.py,sha256=Mrfdcy95-nusl4lovfc4L-LeS909kZGQt7dX65lrcS8,10445
-asktable/models/client_msg.py,sha256=kTiqXcJzIKVFTlKwcFaUp4jqUqwwVGHkW4_-qd_UBvs,1271
+asktable/models/__init__.py,sha256=pBkKlyvFBkoOtuaBJkIz5bixHZovMuu184JGnPWBUsM,248
+asktable/models/client_base.py,sha256=l8d2vCdRxioISSo4Y2o_2_PHlmp1BIuCgJroVaQdMVM,2993
+asktable/models/client_chat.py,sha256=rhkfO5LUZuMhdemZBdtIEvA1C6YNjZlWVvAlc7YqHyQ,2571
+asktable/models/client_ds.py,sha256=9hjHty3iUXRRntlsAMygd_D269LdQThYiammrO4xuxw,10712
+asktable/models/client_msg.py,sha256=hWJ8ZoZ2scasPl3EbxHWvixsnRly0AHa28jgonLiYUk,1270
 asktable/models/client_run.py,sha256=YEu-lhVUPamwN9yLJLLldZXTBppIOMIMZ6wOmoxPsc4,885
+asktable/models/client_securetunnel.py,sha256=0vIeMcJ8akbwLD3X2DGD29K_rqkN2s-JbRDmgo10JaY,1165
 atcommon/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 atcommon/tools.py,sha256=TWlukRR8iaDY0FW4zM1hXO-2xM9NPcDB9PA4eYHipDI,3296
-atcommon/version.py,sha256=gnre4bmCw4_1YEmgmLYrwObbp7vhPdmr0cRXQ1Y9-AU,16
+atcommon/version.py,sha256=7PCgMgR8ldFvrDXH9Xi2UMq5fB3QUkhqh4a2mhwcyO8,16
 atcommon/exceptions/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-atcommon/exceptions/client.py,sha256=qHJfByYYiVOwdAs_L-R655tBmep6Kpg1ixvktBNQNA0,1282
+atcommon/exceptions/client.py,sha256=9NRkVMHEBdCfiaTvz2p5knT6gWwAzhksZJf0yeyo9rI,1402
 atcommon/exceptions/server.py,sha256=BSlYmdfDasoAq6oK9fyGhws3EBPII_hkHpx_JQmMdAY,95
-atcommon/exceptions/server_base.py,sha256=-X7xH1cmypIwl007CvuN2MIGqCv89sYb5jVi7s-Uzkc,2089
-atcommon/exceptions/server_plugins.py,sha256=MqQgXsGHUn0JB3EAos1vlf8SLjUMNGXAY7lcBKSA_8c,589
-atcommon/models/__init__.py,sha256=QDsebmmUAHCKrMs789lDMt9HU9DR0kH-TGnE1CtW9kU,466
+atcommon/exceptions/server_base.py,sha256=MglwHRpeVMmT7jYFJusk_P41-ZELBxHCjry-kH4I3is,2599
+atcommon/exceptions/server_plugins.py,sha256=PvDe7f5Axrjpp97w2TfnhGW0rw33vuDlDzAB0IZiTFI,597
+atcommon/models/__init__.py,sha256=EiUwkIMdsdvZzAlDSDD7509mngAjckTBp65xICcASbk,526
 atcommon/models/base.py,sha256=UVM9dKL22-k4k44H6DYQeNIe35vJ1Vg0ppGDZiVDiIU,731
-atcommon/models/bi.py,sha256=77HEtXOEj2tJwXe34s5Shsu4LWDihxAols8Rcz5cOFU,2344
+atcommon/models/bi.py,sha256=WVkrlkMMkSeV5WhoNr88r1qmEPpAW3HA19YysF5-4j0,4918
 atcommon/models/chat.py,sha256=Si_eo8H8h_NtIOc76qhXoYcHp_tPMavud2sEnUXEejo,1069
 atcommon/models/datasource.py,sha256=Qv-IIC9hDGXrWe5s__4U_f51QNDi9BCMJrf42cUJ5Tg,1424
 atcommon/models/meta.py,sha256=OZesut61aJuotvzhj6k92tvcvaOut6E5v5rNNpFzVGo,27794
-asktable-0.13.9.dist-info/METADATA,sha256=_J_bcBMgfeQkRiCnopgL9z58G5gkLvBHId2Hr1gBSyU,9875
-asktable-0.13.9.dist-info/WHEEL,sha256=Xo9-1PvkuimrydujYJAjF7pCkriuXBpUPEjma1nZyJ0,92
-asktable-0.13.9.dist-info/entry_points.txt,sha256=OS7zXFo5f2wYttNLFf6EScGBaN_2XtYbV_Fl_C3RhY8,47
-asktable-0.13.9.dist-info/top_level.txt,sha256=j_dz8lioIJZMGAy7UUdXv0ytGGhh8HFsGhSXaULxT4M,18
-asktable-0.13.9.dist-info/RECORD,,
+atcommon/models/securetunnel.py,sha256=ps-YFONN4G2PROlbJfUOM6P8NkHS3xNUdqzGXohqrP0,631
+asktable-0.14.0.dist-info/METADATA,sha256=5_BVOIMuZHqGuja17SuGP1LhoNcXm3qW6zS7I3ixAS0,11702
+asktable-0.14.0.dist-info/WHEEL,sha256=Xo9-1PvkuimrydujYJAjF7pCkriuXBpUPEjma1nZyJ0,92
+asktable-0.14.0.dist-info/entry_points.txt,sha256=OS7zXFo5f2wYttNLFf6EScGBaN_2XtYbV_Fl_C3RhY8,47
+asktable-0.14.0.dist-info/top_level.txt,sha256=j_dz8lioIJZMGAy7UUdXv0ytGGhh8HFsGhSXaULxT4M,18
+asktable-0.14.0.dist-info/RECORD,,
```

