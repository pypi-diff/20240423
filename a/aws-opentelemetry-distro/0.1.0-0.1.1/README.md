# Comparing `tmp/aws_opentelemetry_distro-0.1.0-py3-none-any.whl.zip` & `tmp/aws_opentelemetry_distro-0.1.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,18 +1,18 @@
-Zip file size: 49087 bytes, number of entries: 35
+Zip file size: 49681 bytes, number of entries: 35
 -rw-r--r--  2.0 unx      887 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/_aws_attribute_keys.py
 -rw-r--r--  2.0 unx    16342 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/_aws_metric_attribute_generator.py
 -rw-r--r--  2.0 unx     7337 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/_aws_span_processing_util.py
 -rw-r--r--  2.0 unx     2539 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/always_record_sampler.py
 -rw-r--r--  2.0 unx     4671 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/attribute_propagating_span_processor.py
 -rw-r--r--  2.0 unx     2408 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/attribute_propagating_span_processor_builder.py
 -rw-r--r--  2.0 unx     5992 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/aws_metric_attributes_span_exporter.py
 -rw-r--r--  2.0 unx     1466 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/aws_metric_attributes_span_exporter_builder.py
--rw-r--r--  2.0 unx    13432 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/aws_opentelemetry_configurator.py
--rw-r--r--  2.0 unx     1528 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/aws_opentelemetry_distro.py
+-rw-r--r--  2.0 unx    14094 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/aws_opentelemetry_configurator.py
+-rw-r--r--  2.0 unx     2592 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/aws_opentelemetry_distro.py
 -rw-r--r--  2.0 unx     5235 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/aws_span_metrics_processor.py
 -rw-r--r--  2.0 unx     2872 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/aws_span_metrics_processor_builder.py
 -rw-r--r--  2.0 unx     1425 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/metric_attribute_generator.py
 -rw-r--r--  2.0 unx     4072 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/sqs_url_parser.py
 -rw-r--r--  2.0 unx      130 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/version.py
 -rw-r--r--  2.0 unx    16500 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/configuration/sql_dialect_keywords.json
 -rw-r--r--  2.0 unx     4172 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/patches/_botocore_patches.py
@@ -26,12 +26,12 @@
 -rw-r--r--  2.0 unx     1615 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/sampler/_rate_limiting_sampler.py
 -rw-r--r--  2.0 unx     6041 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/sampler/_rule_cache.py
 -rw-r--r--  2.0 unx     2729 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/sampler/_sampling_rule.py
 -rw-r--r--  2.0 unx     9461 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/sampler/_sampling_rule_applier.py
 -rw-r--r--  2.0 unx     1017 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/sampler/_sampling_statistics_document.py
 -rw-r--r--  2.0 unx     2263 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/sampler/_sampling_target.py
 -rw-r--r--  2.0 unx     6747 b- defN 20-Feb-02 00:00 amazon/opentelemetry/distro/sampler/aws_xray_remote_sampler.py
-?rw-r--r--  2.0 unx     4682 b- defN 20-Feb-02 00:00 aws_opentelemetry_distro-0.1.0.dist-info/METADATA
-?rw-r--r--  2.0 unx       87 b- defN 20-Feb-02 00:00 aws_opentelemetry_distro-0.1.0.dist-info/WHEEL
-?rw-r--r--  2.0 unx      249 b- defN 20-Feb-02 00:00 aws_opentelemetry_distro-0.1.0.dist-info/entry_points.txt
-?rw-r--r--  2.0 unx     3940 b- defN 20-Feb-02 00:00 aws_opentelemetry_distro-0.1.0.dist-info/RECORD
-35 files, 144118 bytes uncompressed, 42401 bytes compressed:  70.6%
+?rw-r--r--  2.0 unx     4682 b- defN 20-Feb-02 00:00 aws_opentelemetry_distro-0.1.1.dist-info/METADATA
+?rw-r--r--  2.0 unx       87 b- defN 20-Feb-02 00:00 aws_opentelemetry_distro-0.1.1.dist-info/WHEEL
+?rw-r--r--  2.0 unx      249 b- defN 20-Feb-02 00:00 aws_opentelemetry_distro-0.1.1.dist-info/entry_points.txt
+?rw-r--r--  2.0 unx     3940 b- defN 20-Feb-02 00:00 aws_opentelemetry_distro-0.1.1.dist-info/RECORD
+35 files, 145844 bytes uncompressed, 42995 bytes compressed:  70.5%
```

## zipnote {}

```diff
@@ -87,20 +87,20 @@
 
 Filename: amazon/opentelemetry/distro/sampler/_sampling_target.py
 Comment: 
 
 Filename: amazon/opentelemetry/distro/sampler/aws_xray_remote_sampler.py
 Comment: 
 
-Filename: aws_opentelemetry_distro-0.1.0.dist-info/METADATA
+Filename: aws_opentelemetry_distro-0.1.1.dist-info/METADATA
 Comment: 
 
-Filename: aws_opentelemetry_distro-0.1.0.dist-info/WHEEL
+Filename: aws_opentelemetry_distro-0.1.1.dist-info/WHEEL
 Comment: 
 
-Filename: aws_opentelemetry_distro-0.1.0.dist-info/entry_points.txt
+Filename: aws_opentelemetry_distro-0.1.1.dist-info/entry_points.txt
 Comment: 
 
-Filename: aws_opentelemetry_distro-0.1.0.dist-info/RECORD
+Filename: aws_opentelemetry_distro-0.1.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## amazon/opentelemetry/distro/aws_opentelemetry_configurator.py

```diff
@@ -13,15 +13,14 @@
     AttributePropagatingSpanProcessorBuilder,
 )
 from amazon.opentelemetry.distro.aws_metric_attributes_span_exporter_builder import (
     AwsMetricAttributesSpanExporterBuilder,
 )
 from amazon.opentelemetry.distro.aws_span_metrics_processor_builder import AwsSpanMetricsProcessorBuilder
 from amazon.opentelemetry.distro.sampler.aws_xray_remote_sampler import AwsXRayRemoteSampler
-from opentelemetry.exporter.otlp.proto.grpc.metric_exporter import OTLPMetricExporter as OTLPGrpcOTLPMetricExporter
 from opentelemetry.exporter.otlp.proto.http.metric_exporter import OTLPMetricExporter as OTLPHttpOTLPMetricExporter
 from opentelemetry.sdk._configuration import (
     _get_exporter_names,
     _get_id_generator,
     _get_sampler,
     _import_exporters,
     _import_id_generator,
@@ -270,40 +269,50 @@
         if cls._instance is None:
             cls._instance = super().__new__(cls)
         return cls._instance
 
     # pylint: disable=no-self-use
     def create_exporter(self):
         protocol = os.environ.get(
-            OTEL_EXPORTER_OTLP_METRICS_PROTOCOL, os.environ.get(OTEL_EXPORTER_OTLP_PROTOCOL, "grpc")
+            OTEL_EXPORTER_OTLP_METRICS_PROTOCOL, os.environ.get(OTEL_EXPORTER_OTLP_PROTOCOL, "http/protobuf")
         )
         _logger.debug("AWS Application Signals export protocol: %s", protocol)
 
-        application_signals_endpoint = os.environ.get(
-            APPLICATION_SIGNALS_EXPORTER_ENDPOINT_CONFIG,
-            os.environ.get(APP_SIGNALS_EXPORTER_ENDPOINT_CONFIG, "http://localhost:4315"),
-        )
-
-        _logger.debug("AWS Application Signals export endpoint: %s", application_signals_endpoint)
-
         temporality_dict: Dict[type, AggregationTemporality] = {}
         for typ in [
             Counter,
             UpDownCounter,
             ObservableCounter,
             ObservableCounter,
             ObservableUpDownCounter,
             ObservableGauge,
             Histogram,
         ]:
             temporality_dict[typ] = AggregationTemporality.DELTA
 
         if protocol == "http/protobuf":
+            application_signals_endpoint = os.environ.get(
+                APPLICATION_SIGNALS_EXPORTER_ENDPOINT_CONFIG,
+                os.environ.get(APP_SIGNALS_EXPORTER_ENDPOINT_CONFIG, "http://localhost:4316/v1/metrics"),
+            )
+            _logger.debug("AWS Application Signals export endpoint: %s", application_signals_endpoint)
             return OTLPHttpOTLPMetricExporter(
                 endpoint=application_signals_endpoint, preferred_temporality=temporality_dict
             )
         if protocol == "grpc":
+            # pylint: disable=import-outside-toplevel
+            # Delay import to only occur if gRPC specifically requested. Vended Docker image will not have gRPC bundled,
+            # so importing it at the class level can cause runtime failures.
+            from opentelemetry.exporter.otlp.proto.grpc.metric_exporter import (
+                OTLPMetricExporter as OTLPGrpcOTLPMetricExporter,
+            )
+
+            application_signals_endpoint = os.environ.get(
+                APPLICATION_SIGNALS_EXPORTER_ENDPOINT_CONFIG,
+                os.environ.get(APP_SIGNALS_EXPORTER_ENDPOINT_CONFIG, "localhost:4315"),
+            )
+            _logger.debug("AWS Application Signals export endpoint: %s", application_signals_endpoint)
             return OTLPGrpcOTLPMetricExporter(
                 endpoint=application_signals_endpoint, preferred_temporality=temporality_dict
             )
 
         raise RuntimeError(f"Unsupported AWS Application Signals export protocol: {protocol} ")
```

## amazon/opentelemetry/distro/aws_opentelemetry_distro.py

```diff
@@ -1,31 +1,50 @@
 # Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 # SPDX-License-Identifier: Apache-2.0
 import os
 
 from amazon.opentelemetry.distro.patches._instrumentation_patch import apply_instrumentation_patches
 from opentelemetry.distro import OpenTelemetryDistro
 from opentelemetry.environment_variables import OTEL_PROPAGATORS, OTEL_PYTHON_ID_GENERATOR
-from opentelemetry.sdk.environment_variables import OTEL_EXPORTER_OTLP_METRICS_DEFAULT_HISTOGRAM_AGGREGATION
+from opentelemetry.sdk.environment_variables import (
+    OTEL_EXPORTER_OTLP_METRICS_DEFAULT_HISTOGRAM_AGGREGATION,
+    OTEL_EXPORTER_OTLP_PROTOCOL,
+)
 
 
 class AwsOpenTelemetryDistro(OpenTelemetryDistro):
     def _configure(self, **kwargs):
-        """
+        """Sets up default environment variables and apply patches
+
+        Set default OTEL_EXPORTER_OTLP_PROTOCOL to be HTTP. This must be run before super(), which attempts to set the
+        default to gRPC. If we run afterwards, we don't know if the default was set by base OpenTelemetryDistro or if it
+        was set by the user. We are setting to HTTP as gRPC does not work out of the box for the vended docker image,
+        due to gRPC having a strict dependency on the Python version the artifact was built for (OTEL observed this:
+        https://github.com/open-telemetry/opentelemetry-operator/blob/461ba68e80e8ac6bf2603eb353547cd026119ed2/autoinstrumentation/python/requirements.txt#L2-L3)
+
+        Also sets default OTEL_PROPAGATORS, OTEL_PYTHON_ID_GENERATOR, and
+        OTEL_EXPORTER_OTLP_METRICS_DEFAULT_HISTOGRAM_AGGREGATION to ensure good compatibility with X-Ray and Application
+        Signals.
+
+        Also applies patches to upstream instrumentation - usually these are stopgap measures until we can contribute
+        long-term changes to upstream.
+
         kwargs:
             apply_patches: bool - apply patches to upstream instrumentation. Default is True.
 
         TODO:
          1. OTLPMetricExporterMixin is using hard coded histogram_aggregation_type, which reads
             OTEL_EXPORTER_OTLP_METRICS_DEFAULT_HISTOGRAM_AGGREGATION environment variable. Need to work with upstream to
             make it to be configurable.
         """
+        os.environ.setdefault(OTEL_EXPORTER_OTLP_PROTOCOL, "http/protobuf")
+
         super(AwsOpenTelemetryDistro, self)._configure()
+
+        os.environ.setdefault(OTEL_PROPAGATORS, "xray,tracecontext,b3,b3multi")
+        os.environ.setdefault(OTEL_PYTHON_ID_GENERATOR, "xray")
         os.environ.setdefault(
             OTEL_EXPORTER_OTLP_METRICS_DEFAULT_HISTOGRAM_AGGREGATION, "base2_exponential_bucket_histogram"
         )
-        os.environ.setdefault(OTEL_PROPAGATORS, "xray,tracecontext,b3,b3multi")
-        os.environ.setdefault(OTEL_PYTHON_ID_GENERATOR, "xray")
 
-        # Apply patches to upstream instrumentation - usually stopgap measures until we can contribute long-term changes
         if kwargs.get("apply_patches", True):
             apply_instrumentation_patches()
```

## amazon/opentelemetry/distro/version.py

```diff
@@ -1,4 +1,4 @@
 # Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 # SPDX-License-Identifier: Apache-2.0
 
-__version__ = "0.1.0"
+__version__ = "0.1.1"
```

## Comparing `aws_opentelemetry_distro-0.1.0.dist-info/METADATA` & `aws_opentelemetry_distro-0.1.1.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.3
 Name: aws-opentelemetry-distro
-Version: 0.1.0
+Version: 0.1.1
 Summary: AWS OpenTelemetry Python Distro
 Project-URL: Homepage, https://github.com/aws-observability/aws-otel-python-instrumentation/tree/main/aws-opentelemetry-distro
 Author: Amazon Web Services
 License-Expression: Apache-2.0
 Classifier: Development Status :: 4 - Beta
 Classifier: Intended Audience :: Developers
 Classifier: License :: OSI Approved :: Apache Software License
```

## Comparing `aws_opentelemetry_distro-0.1.0.dist-info/RECORD` & `aws_opentelemetry_distro-0.1.1.dist-info/RECORD`

 * *Files 7% similar despite different names*

```diff
@@ -2,21 +2,21 @@
 amazon/opentelemetry/distro/_aws_metric_attribute_generator.py,sha256=MMKZ5oh51TxFgXp26TTBdoE4edl6F5-pVny0GTUkpjE,16342
 amazon/opentelemetry/distro/_aws_span_processing_util.py,sha256=BrqxhYYzpDtVJODWINy3OxfW24dCFX3PRNR2Y-dVRQs,7337
 amazon/opentelemetry/distro/always_record_sampler.py,sha256=zq3EyY56kjTgSZ1-QsKu5uFa952BcFRoHC_ZUisSg2M,2539
 amazon/opentelemetry/distro/attribute_propagating_span_processor.py,sha256=l2sVIrYTi3CROK0aZDs6AA5Wwde-STDYGKrFsmQM4KQ,4671
 amazon/opentelemetry/distro/attribute_propagating_span_processor_builder.py,sha256=4JbXewZ2bMcFc9nGnnsrW9cfGYEpZI4phWO4ztTqjNY,2408
 amazon/opentelemetry/distro/aws_metric_attributes_span_exporter.py,sha256=UtYV9Xfnu2it-WqDjqVlCyUWWGJJz0nNkbuMdXzPnjU,5992
 amazon/opentelemetry/distro/aws_metric_attributes_span_exporter_builder.py,sha256=cP-v9NOFOhhnuL_keFgLO1sBfMctUL5MzDQu71WqenY,1466
-amazon/opentelemetry/distro/aws_opentelemetry_configurator.py,sha256=2SShM4ymJDixnYZgHWjJqPM3BojnddQ_gLu-nMBSqVA,13432
-amazon/opentelemetry/distro/aws_opentelemetry_distro.py,sha256=9Uvz5B6wxa1pvPbZQjYRzNg4JJJH9C2HpHAbdos-d5o,1528
+amazon/opentelemetry/distro/aws_opentelemetry_configurator.py,sha256=bXStGvaQCZn92hK2ltxZg8vO2Wy_paP8SdbCIV6ke0Y,14094
+amazon/opentelemetry/distro/aws_opentelemetry_distro.py,sha256=7z2rNrm-CT4_VvZTr3ndkMSf1muN6VhiKglg6jTJIag,2592
 amazon/opentelemetry/distro/aws_span_metrics_processor.py,sha256=IjxvnxdBwlEzHmFov7N-OSHZXRW5wqLhlRxJHQrlURM,5235
 amazon/opentelemetry/distro/aws_span_metrics_processor_builder.py,sha256=3QUXNpHTJyYK3PSeHAHfL3i7FcHNDAZadovz4MDwEsQ,2872
 amazon/opentelemetry/distro/metric_attribute_generator.py,sha256=2YZymKnnwUJS-7xPPI3zAHRnkTJtHRVQj__tRLTzZ9M,1425
 amazon/opentelemetry/distro/sqs_url_parser.py,sha256=jidMkHwo_jP0Ox1a8zmjfJKTW60qGABtQMKriOPVJBg,4072
-amazon/opentelemetry/distro/version.py,sha256=YkCT60hA9cyL0OD25MjEPuR04LbOBnqxdv0lc7R6R9M,130
+amazon/opentelemetry/distro/version.py,sha256=N0sf00pSHzHOHx_-mDgQlPspNY_KFAyh1ETG6HzmKjo,130
 amazon/opentelemetry/distro/configuration/sql_dialect_keywords.json,sha256=Gl92Xdx7EpPN5HlkZr1RU_BUvCTuklMaVE73kduH0yk,16500
 amazon/opentelemetry/distro/patches/_botocore_patches.py,sha256=t6xsgs31ks0oAyAqPiLI-3Gn7P0Kx8cMImgAKsE3HcU,4172
 amazon/opentelemetry/distro/patches/_instrumentation_patch.py,sha256=e2hEX__FmNZS9W-HzITO5znNkKaztXi6kVeJdHs6kI8,1841
 amazon/opentelemetry/distro/patches/_resource_detector_patches.py,sha256=1f4FQQiC4oJOXdh7TU47AkZ48HrdgK9NrLkdIm2akyo,1623
 amazon/opentelemetry/distro/sampler/_aws_xray_sampling_client.py,sha256=vOztNhoo2KDHqE5vagzsHkHQvaUOLI0Rb9XP9Tr7wvE,4146
 amazon/opentelemetry/distro/sampler/_clock.py,sha256=6M8hhv2FEgmggl3rVnFTB62VkUUzTiwL2G7MQOwPmUc,642
 amazon/opentelemetry/distro/sampler/_fallback_sampler.py,sha256=By1a0jyfy7W7DZn4GJm2OkdDrO9kYuKUepAsRaso3CE,1833
@@ -25,11 +25,11 @@
 amazon/opentelemetry/distro/sampler/_rate_limiting_sampler.py,sha256=wJR7AlbXh57FDaoNV2NYWKW4ZjDBz_3OuV4M4UNKKxQ,1615
 amazon/opentelemetry/distro/sampler/_rule_cache.py,sha256=1SxwCUwNNpJFOLYtXXcEOiDkclxo5WLugt7gsJ56yiw,6041
 amazon/opentelemetry/distro/sampler/_sampling_rule.py,sha256=fp-06Ur4bDtBTCXLHU2rN-wHWmOUluL_IAhINj4jRUc,2729
 amazon/opentelemetry/distro/sampler/_sampling_rule_applier.py,sha256=TNpgbhoBVg9TkJp2oZ_0zGLV14tDxJzw8FxadJWW2ic,9461
 amazon/opentelemetry/distro/sampler/_sampling_statistics_document.py,sha256=C9evmg9vfEMJzq5FfRkImBoT191ICJ1Fhth6nTWg6ZI,1017
 amazon/opentelemetry/distro/sampler/_sampling_target.py,sha256=wccite2KK9CsWA6QudlnGUwCgbdCpeo6vGhMq2TPCYM,2263
 amazon/opentelemetry/distro/sampler/aws_xray_remote_sampler.py,sha256=e7hAPPnBtNPukKnThZIyF4SjouIbbH8S-M-of8d5Ees,6747
-aws_opentelemetry_distro-0.1.0.dist-info/METADATA,sha256=zvjmHYnjduJAxK0aTGZVTc6vzqeoI7XgshuraT_x1ko,4682
-aws_opentelemetry_distro-0.1.0.dist-info/WHEEL,sha256=xl5aZkiJYVTjhVaiADvIe6UeUVylGNomrxKZ0Zda1CE,87
-aws_opentelemetry_distro-0.1.0.dist-info/entry_points.txt,sha256=GgVt2TsDQc86JNySAMv8hwEg9umy3cniBKUFWLzhgSU,249
-aws_opentelemetry_distro-0.1.0.dist-info/RECORD,,
+aws_opentelemetry_distro-0.1.1.dist-info/METADATA,sha256=3XXMb_JpA5xpKGLMD4y8jaiHyJsTDH7HU8j1UHlCM4g,4682
+aws_opentelemetry_distro-0.1.1.dist-info/WHEEL,sha256=zEMcRr9Kr03x1ozGwg5v9NQBKn3kndp6LSoSlVg-jhU,87
+aws_opentelemetry_distro-0.1.1.dist-info/entry_points.txt,sha256=GgVt2TsDQc86JNySAMv8hwEg9umy3cniBKUFWLzhgSU,249
+aws_opentelemetry_distro-0.1.1.dist-info/RECORD,,
```

